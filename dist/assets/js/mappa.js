var is=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);import{l as os,U as as,a as ls}from"./universalFooter-DRDAn_Zc.js";import{p as cs}from"./dataParser-DPOaL89J.js";import{i as us}from"./initMap-CoPbO_Us.js";import{F as ds,P as hs,D as fs,a as ps,R as ut,N as Sr,M as gs}from"./modalRenderer-BQCKlDBe.js";import"./_commonjsHelpers-BosuxZz1.js";var Ra=is((fe,pe)=>{var vn=typeof global=="object"&&global&&global.Object===Object&&global,ms=typeof self=="object"&&self&&self.Object===Object&&self,_e=vn||ms||Function("return this")(),me=_e.Symbol,wn=Object.prototype,vs=wn.hasOwnProperty,ws=wn.toString,Ze=me?me.toStringTag:void 0,ys=Object.prototype.toString,bs="[object Null]",xs="[object Undefined]",Cr=me?me.toStringTag:void 0;function Ge(r){return r==null?r===void 0?xs:bs:Cr&&Cr in Object(r)?function(e){var t=vs.call(e,Ze),n=e[Ze];try{e[Ze]=void 0;var s=!0}catch{}var i=ws.call(e);return s&&(t?e[Ze]=n:delete e[Ze]),i}(r):function(e){return ys.call(e)}(r)}function Me(r){return r!=null&&typeof r=="object"}var _s="[object Symbol]";function qe(r){return typeof r=="symbol"||Me(r)&&Ge(r)==_s}function He(r,e){for(var t=-1,n=r==null?0:r.length,s=Array(n);++t<n;)s[t]=e(r[t],t,r);return s}var ie=Array.isArray,Er=me?me.prototype:void 0,Mr=Er?Er.toString:void 0;function yn(r){if(typeof r=="string")return r;if(ie(r))return He(r,yn)+"";if(qe(r))return Mr?Mr.call(r):"";var e=r+"";return e=="0"&&1/r==-1/0?"-0":e}function ze(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}function St(r){return r}var Ss="[object AsyncFunction]",Cs="[object Function]",Es="[object GeneratorFunction]",Ms="[object Proxy]";function bn(r){if(!ze(r))return!1;var e=Ge(r);return e==Cs||e==Es||e==Ss||e==Ms}var kr,Rt=_e["__core-js_shared__"],Fr=(kr=/[^.]+$/.exec(Rt&&Rt.keys&&Rt.keys.IE_PROTO||""))?"Symbol(src)_1."+kr:"",ks=Function.prototype.toString;function Te(r){if(r!=null){try{return ks.call(r)}catch{}try{return r+""}catch{}}return""}var Fs=/^\[object .+?Constructor\]$/,As=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Be(r,e){var t=function(n,s){return n==null?void 0:n[s]}(r,e);return function(n){return!(!ze(n)||(s=n,Fr&&Fr in s))&&(bn(n)?As:Fs).test(Te(n));var s}(t)?t:void 0}var Ar,zt,Tt,Ht=Be(_e,"WeakMap"),Or=Object.create,Os=function(){function r(){}return function(e){if(!ze(e))return{};if(Or)return Or(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}(),js=Date.now,Ls=function(){try{var r=Be(Object,"defineProperty");return r({},"",{}),r}catch{}}(),yt=Ls,Is=yt?function(r,e){return yt(r,"toString",{configurable:!0,enumerable:!1,value:(t=e,function(){return t}),writable:!0});var t}:St,Ns=(Ar=Is,zt=0,Tt=0,function(){var r=js(),e=16-(r-Tt);if(Tt=r,e>0){if(++zt>=800)return arguments[0]}else zt=0;return Ar.apply(void 0,arguments)});function Ps(r){return r!=r}function Rs(r,e){return!(r==null||!r.length)&&function(t,n,s){return n==n?function(i,o,a){for(var c=-1,d=i.length;++c<d;)if(i[c]===o)return c;return-1}(t,n):function(i,o,a,c){for(var d=i.length,f=-1;++f<d;)if(o(i[f],f,i))return f;return-1}(t,Ps)}(r,e)>-1}var zs=9007199254740991,Ts=/^(?:0|[1-9]\d*)$/;function rr(r,e){var t=typeof r;return!!(e=e??zs)&&(t=="number"||t!="symbol"&&Ts.test(r))&&r>-1&&r%1==0&&r<e}function nr(r,e,t){e=="__proto__"&&yt?yt(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}function Ct(r,e){return r===e||r!=r&&e!=e}var Bs=Object.prototype.hasOwnProperty;function xn(r,e,t){var n=r[e];Bs.call(r,e)&&Ct(n,t)&&(t!==void 0||e in r)||nr(r,e,t)}function dt(r,e,t,n){var s=!t;t||(t={});for(var i=-1,o=e.length;++i<o;){var a=e[i],c=void 0;c===void 0&&(c=r[a]),s?nr(t,a,c):xn(t,a,c)}return t}var jr=Math.max;function _n(r,e){return Ns(function(t,n,s){return n=jr(n===void 0?t.length-1:n,0),function(){for(var i=arguments,o=-1,a=jr(i.length-n,0),c=Array(a);++o<a;)c[o]=i[n+o];o=-1;for(var d=Array(n+1);++o<n;)d[o]=i[o];return d[n]=s(c),function(f,w,m){switch(m.length){case 0:return f.call(w);case 1:return f.call(w,m[0]);case 2:return f.call(w,m[0],m[1]);case 3:return f.call(w,m[0],m[1],m[2])}return f.apply(w,m)}(t,this,d)}}(r,e,St),r+"")}var $s=9007199254740991;function sr(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=$s}function Je(r){return r!=null&&sr(r.length)&&!bn(r)}function Lr(r,e,t){if(!ze(t))return!1;var n=typeof e;return!!(n=="number"?Je(t)&&rr(e,t.length):n=="string"&&e in t)&&Ct(t[e],r)}var Ds=Object.prototype;function ir(r){var e=r&&r.constructor;return r===(typeof e=="function"&&e.prototype||Ds)}function Ir(r){return Me(r)&&Ge(r)=="[object Arguments]"}var Sn=Object.prototype,Us=Sn.hasOwnProperty,Vs=Sn.propertyIsEnumerable,or=Ir(function(){return arguments}())?Ir:function(r){return Me(r)&&Us.call(r,"callee")&&!Vs.call(r,"callee")},Cn=typeof fe=="object"&&fe&&!fe.nodeType&&fe,Nr=Cn&&typeof pe=="object"&&pe&&!pe.nodeType&&pe,Pr=Nr&&Nr.exports===Cn?_e.Buffer:void 0,bt=(Pr?Pr.isBuffer:void 0)||function(){return!1},J={};function Et(r){return function(e){return r(e)}}J["[object Float32Array]"]=J["[object Float64Array]"]=J["[object Int8Array]"]=J["[object Int16Array]"]=J["[object Int32Array]"]=J["[object Uint8Array]"]=J["[object Uint8ClampedArray]"]=J["[object Uint16Array]"]=J["[object Uint32Array]"]=!0,J["[object Arguments]"]=J["[object Array]"]=J["[object ArrayBuffer]"]=J["[object Boolean]"]=J["[object DataView]"]=J["[object Date]"]=J["[object Error]"]=J["[object Function]"]=J["[object Map]"]=J["[object Number]"]=J["[object Object]"]=J["[object RegExp]"]=J["[object Set]"]=J["[object String]"]=J["[object WeakMap]"]=!1;var En=typeof fe=="object"&&fe&&!fe.nodeType&&fe,et=En&&typeof pe=="object"&&pe&&!pe.nodeType&&pe,Bt=et&&et.exports===En&&vn.process,We=function(){try{return et&&et.require&&et.require("util").types||Bt&&Bt.binding&&Bt.binding("util")}catch{}}(),Rr=We&&We.isTypedArray,Mn=Rr?Et(Rr):function(r){return Me(r)&&sr(r.length)&&!!J[Ge(r)]},Hs=Object.prototype.hasOwnProperty;function kn(r,e){var t=ie(r),n=!t&&or(r),s=!t&&!n&&bt(r),i=!t&&!n&&!s&&Mn(r),o=t||n||s||i,a=o?function(f,w){for(var m=-1,h=Array(f);++m<f;)h[m]=w(m);return h}(r.length,String):[],c=a.length;for(var d in r)!e&&!Hs.call(r,d)||o&&(d=="length"||s&&(d=="offset"||d=="parent")||i&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||rr(d,c))||a.push(d);return a}function Fn(r,e){return function(t){return r(e(t))}}var qs=Fn(Object.keys,Object),Ws=Object.prototype.hasOwnProperty;function it(r){return Je(r)?kn(r):function(e){if(!ir(e))return qs(e);var t=[];for(var n in Object(e))Ws.call(e,n)&&n!="constructor"&&t.push(n);return t}(r)}var Gs=Object.prototype.hasOwnProperty;function Js(r){return Je(r)?kn(r,!0):function(e){if(!ze(e))return function(i){var o=[];if(i!=null)for(var a in Object(i))o.push(a);return o}(e);var t=ir(e),n=[];for(var s in e)(s!="constructor"||!t&&Gs.call(e,s))&&n.push(s);return n}(r)}var Qs=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Xs=/^\w*$/;function qt(r,e){if(ie(r))return!1;var t=typeof r;return!(t!="number"&&t!="symbol"&&t!="boolean"&&r!=null&&!qe(r))||Xs.test(r)||!Qs.test(r)||e!=null&&r in Object(e)}var Ke=Be(Object,"create"),Ys=Object.prototype.hasOwnProperty,Zs=Object.prototype.hasOwnProperty;function Pe(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}function ht(r,e){for(var t=r.length;t--;)if(Ct(r[t][0],e))return t;return-1}Pe.prototype.clear=function(){this.__data__=Ke?Ke(null):{},this.size=0},Pe.prototype.delete=function(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e},Pe.prototype.get=function(r){var e=this.__data__;if(Ke){var t=e[r];return t==="__lodash_hash_undefined__"?void 0:t}return Ys.call(e,r)?e[r]:void 0},Pe.prototype.has=function(r){var e=this.__data__;return Ke?e[r]!==void 0:Zs.call(e,r)},Pe.prototype.set=function(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=Ke&&e===void 0?"__lodash_hash_undefined__":e,this};var Ks=Array.prototype.splice;function Ee(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}Ee.prototype.clear=function(){this.__data__=[],this.size=0},Ee.prototype.delete=function(r){var e=this.__data__,t=ht(e,r);return!(t<0||(t==e.length-1?e.pop():Ks.call(e,t,1),--this.size,0))},Ee.prototype.get=function(r){var e=this.__data__,t=ht(e,r);return t<0?void 0:e[t][1]},Ee.prototype.has=function(r){return ht(this.__data__,r)>-1},Ee.prototype.set=function(r,e){var t=this.__data__,n=ht(t,r);return n<0?(++this.size,t.push([r,e])):t[n][1]=e,this};var rt=Be(_e,"Map");function ft(r,e){var t,n,s=r.__data__;return((n=typeof(t=e))=="string"||n=="number"||n=="symbol"||n=="boolean"?t!=="__proto__":t===null)?s[typeof e=="string"?"string":"hash"]:s.map}function Ce(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}function ar(r,e){if(typeof r!="function"||e!=null&&typeof e!="function")throw new TypeError("Expected a function");var t=function(){var n=arguments,s=e?e.apply(this,n):n[0],i=t.cache;if(i.has(s))return i.get(s);var o=r.apply(this,n);return t.cache=i.set(s,o)||i,o};return t.cache=new(ar.Cache||Ce),t}Ce.prototype.clear=function(){this.size=0,this.__data__={hash:new Pe,map:new(rt||Ee),string:new Pe}},Ce.prototype.delete=function(r){var e=ft(this,r).delete(r);return this.size-=e?1:0,e},Ce.prototype.get=function(r){return ft(this,r).get(r)},Ce.prototype.has=function(r){return ft(this,r).has(r)},Ce.prototype.set=function(r,e){var t=ft(this,r),n=t.size;return t.set(r,e),this.size+=t.size==n?0:1,this},ar.Cache=Ce;var $t,Dt,ei=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ti=/\\(\\)?/g,ri=($t=ar(function(r){var e=[];return r.charCodeAt(0)===46&&e.push(""),r.replace(ei,function(t,n,s,i){e.push(s?i.replace(ti,"$1"):n||t)}),e},function(r){return Dt.size===500&&Dt.clear(),r}),Dt=$t.cache,$t);function An(r,e){return ie(r)?r:qt(r,e)?[r]:ri(function(t){return t==null?"":yn(t)}(r))}function mt(r){if(typeof r=="string"||qe(r))return r;var e=r+"";return e=="0"&&1/r==-1/0?"-0":e}function Wt(r,e){for(var t=0,n=(e=An(e,r)).length;r!=null&&t<n;)r=r[mt(e[t++])];return t&&t==n?r:void 0}function lr(r,e){for(var t=-1,n=e.length,s=r.length;++t<n;)r[s+t]=e[t];return r}var zr=me?me.isConcatSpreadable:void 0;function ni(r){return ie(r)||or(r)||!!(zr&&r&&r[zr])}function si(r,e,t,n,s){var i=-1,o=r.length;for(t||(t=ni),s||(s=[]);++i<o;){var a=r[i];t(a)?lr(s,a):s[s.length]=a}return s}var On=Fn(Object.getPrototypeOf,Object);function xe(r){var e=this.__data__=new Ee(r);this.size=e.size}xe.prototype.clear=function(){this.__data__=new Ee,this.size=0},xe.prototype.delete=function(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t},xe.prototype.get=function(r){return this.__data__.get(r)},xe.prototype.has=function(r){return this.__data__.has(r)},xe.prototype.set=function(r,e){var t=this.__data__;if(t instanceof Ee){var n=t.__data__;if(!rt||n.length<199)return n.push([r,e]),this.size=++t.size,this;t=this.__data__=new Ce(n)}return t.set(r,e),this.size=t.size,this};var jn=typeof fe=="object"&&fe&&!fe.nodeType&&fe,Tr=jn&&typeof pe=="object"&&pe&&!pe.nodeType&&pe,Br=Tr&&Tr.exports===jn?_e.Buffer:void 0,$r=Br?Br.allocUnsafe:void 0;function Ln(){return[]}var ii=Object.prototype.propertyIsEnumerable,Dr=Object.getOwnPropertySymbols,oi=Dr?function(r){return r==null?[]:(r=Object(r),function(e,t){for(var n=-1,s=e==null?0:e.length,i=0,o=[];++n<s;){var a=e[n];ii.call(r,a)&&(o[i++]=a)}return o}(Dr(r)))}:Ln,cr=oi,ai=Object.getOwnPropertySymbols?function(r){for(var e=[];r;)lr(e,cr(r)),r=On(r);return e}:Ln;function li(r,e,t){var n=e(r);return ie(r)?n:lr(n,t(r))}function Gt(r){return li(r,it,cr)}var Jt=Be(_e,"DataView"),Qt=Be(_e,"Promise"),Xt=Be(_e,"Set"),Ur="[object Map]",Vr="[object Promise]",Hr="[object Set]",qr="[object WeakMap]",Wr="[object DataView]",ci=Te(Jt),ui=Te(rt),di=Te(Qt),hi=Te(Xt),fi=Te(Ht),Ne=Ge;(Jt&&Ne(new Jt(new ArrayBuffer(1)))!=Wr||rt&&Ne(new rt)!=Ur||Qt&&Ne(Qt.resolve())!=Vr||Xt&&Ne(new Xt)!=Hr||Ht&&Ne(new Ht)!=qr)&&(Ne=function(r){var e=Ge(r),t=e=="[object Object]"?r.constructor:void 0,n=t?Te(t):"";if(n)switch(n){case ci:return Wr;case ui:return Ur;case di:return Vr;case hi:return Hr;case fi:return qr}return e});var nt=Ne,pi=Object.prototype.hasOwnProperty,xt=_e.Uint8Array;function gi(r){var e=new r.constructor(r.byteLength);return new xt(e).set(new xt(r)),e}var mi=/\w*$/,Gr=me?me.prototype:void 0,Jr=Gr?Gr.valueOf:void 0,vi="[object Boolean]",wi="[object Date]",yi="[object Map]",bi="[object Number]",xi="[object RegExp]",_i="[object Set]",Si="[object String]",Ci="[object Symbol]",Ei="[object ArrayBuffer]",Mi="[object DataView]",ki="[object Float32Array]",Fi="[object Float64Array]",Ai="[object Int8Array]",Oi="[object Int16Array]",ji="[object Int32Array]",Li="[object Uint8Array]",Ii="[object Uint8ClampedArray]",Ni="[object Uint16Array]",Pi="[object Uint32Array]",Qr=We&&We.isMap,Ri=Qr?Et(Qr):function(r){return Me(r)&&nt(r)=="[object Map]"},Xr=We&&We.isSet,zi=Xr?Et(Xr):function(r){return Me(r)&&nt(r)=="[object Set]"},Ti=2,In="[object Arguments]",Nn="[object Function]",Bi="[object GeneratorFunction]",Pn="[object Object]",W={};function vt(r,e,t,n,s,i){var o,a=e&Ti;if(o!==void 0)return o;if(!ze(r))return r;var c=ie(r);if(c)return o=function(h){var y=h.length,x=new h.constructor(y);return y&&typeof h[0]=="string"&&pi.call(h,"index")&&(x.index=h.index,x.input=h.input),x}(r),function(h,y){var x=-1,C=h.length;for(y||(y=Array(C));++x<C;)y[x]=h[x];return y}(r,o);var d=nt(r),f=d==Nn||d==Bi;if(bt(r))return function(h,y){var x=h.length,C=$r?$r(x):new h.constructor(x);return h.copy(C),C}(r);if(d==Pn||d==In||f&&!s)return o=f?{}:function(h){return typeof h.constructor!="function"||ir(h)?{}:Os(On(h))}(r),a?function(h,y){return dt(h,ai(h),y)}(r,function(h,y){return h&&dt(y,Js(y),h)}(o,r)):function(h,y){return dt(h,cr(h),y)}(r,function(h,y){return h&&dt(y,it(y),h)}(o,r));if(!W[d])return s?r:{};o=function(h,y,x){var C,j,P=h.constructor;switch(y){case Ei:return gi(h);case vi:case wi:return new P(+h);case Mi:return function(T,z){var V=T.buffer;return new T.constructor(V,T.byteOffset,T.byteLength)}(h);case ki:case Fi:case Ai:case Oi:case ji:case Li:case Ii:case Ni:case Pi:return function(T,z){var V=T.buffer;return new T.constructor(V,T.byteOffset,T.length)}(h);case yi:return new P;case bi:case Si:return new P(h);case xi:return(j=new(C=h).constructor(C.source,mi.exec(C))).lastIndex=C.lastIndex,j;case _i:return new P;case Ci:return Jr?Object(Jr.call(h)):{}}}(r,d),i||(i=new xe);var w=i.get(r);if(w)return w;i.set(r,o),zi(r)?r.forEach(function(h){o.add(vt(h,e,t,h,r,i))}):Ri(r)&&r.forEach(function(h,y){o.set(y,vt(h,e,t,y,r,i))});var m=c?void 0:Gt(r);return function(h,y){for(var x=-1,C=h==null?0:h.length;++x<C&&y(h[x],x)!==!1;);}(m||r,function(h,y){m&&(h=r[y=h]),xn(o,y,vt(h,e,t,y,r,i))}),o}function Ut(r){return vt(r,4)}function tt(r){var e=-1,t=r==null?0:r.length;for(this.__data__=new Ce;++e<t;)this.add(r[e])}function $i(r,e){for(var t=-1,n=r==null?0:r.length;++t<n;)if(e(r[t],t,r))return!0;return!1}function Yt(r,e){return r.has(e)}W[In]=W["[object Array]"]=W["[object ArrayBuffer]"]=W["[object DataView]"]=W["[object Boolean]"]=W["[object Date]"]=W["[object Float32Array]"]=W["[object Float64Array]"]=W["[object Int8Array]"]=W["[object Int16Array]"]=W["[object Int32Array]"]=W["[object Map]"]=W["[object Number]"]=W[Pn]=W["[object RegExp]"]=W["[object Set]"]=W["[object String]"]=W["[object Symbol]"]=W["[object Uint8Array]"]=W["[object Uint8ClampedArray]"]=W["[object Uint16Array]"]=W["[object Uint32Array]"]=!0,W["[object Error]"]=W[Nn]=W["[object WeakMap]"]=!1,tt.prototype.add=tt.prototype.push=function(r){return this.__data__.set(r,"__lodash_hash_undefined__"),this},tt.prototype.has=function(r){return this.__data__.has(r)};var Di=1,Ui=2;function Yr(r,e,t,n,s,i){var o=t&Di,a=r.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var d=i.get(r),f=i.get(e);if(d&&f)return d==e&&f==r;var w=-1,m=!0,h=t&Ui?new tt:void 0;for(i.set(r,e),i.set(e,r);++w<a;){var y=r[w],x=e[w];if(n)var C=o?n(x,y,w,e,r,i):n(y,x,w,r,e,i);if(C!==void 0){if(C)continue;m=!1;break}if(h){if(!$i(e,function(j,P){if(!Yt(h,P)&&(y===j||s(y,j,t,n,i)))return h.push(P)})){m=!1;break}}else if(y!==x&&!s(y,x,t,n,i)){m=!1;break}}return i.delete(r),i.delete(e),m}function Vi(r){var e=-1,t=Array(r.size);return r.forEach(function(n,s){t[++e]=[s,n]}),t}function Hi(r){var e=-1,t=Array(r.size);return r.forEach(function(n){t[++e]=n}),t}var qi=1,Wi=2,Gi="[object Boolean]",Ji="[object Date]",Qi="[object Error]",Xi="[object Map]",Yi="[object Number]",Zi="[object RegExp]",Ki="[object Set]",eo="[object String]",to="[object Symbol]",ro="[object ArrayBuffer]",no="[object DataView]",Zr=me?me.prototype:void 0,Vt=Zr?Zr.valueOf:void 0,so=1,io=Object.prototype.hasOwnProperty,oo=1,Kr="[object Arguments]",en="[object Array]",pt="[object Object]",tn=Object.prototype.hasOwnProperty;function Zt(r,e,t,n,s){return r===e||(r==null||e==null||!Me(r)&&!Me(e)?r!=r&&e!=e:function(i,o,a,c,d,f){var w=ie(i),m=ie(o),h=w?en:nt(i),y=m?en:nt(o),x=(h=h==Kr?pt:h)==pt,C=(y=y==Kr?pt:y)==pt,j=h==y;if(j&&bt(i)){if(!bt(o))return!1;w=!0,x=!1}if(j&&!x)return f||(f=new xe),w||Mn(i)?Yr(i,o,a,c,d,f):function(L,N,G,ce,we,te,le){switch(G){case no:if(L.byteLength!=N.byteLength||L.byteOffset!=N.byteOffset)return!1;L=L.buffer,N=N.buffer;case ro:return!(L.byteLength!=N.byteLength||!te(new xt(L),new xt(N)));case Gi:case Ji:case Yi:return Ct(+L,+N);case Qi:return L.name==N.name&&L.message==N.message;case Zi:case eo:return L==N+"";case Xi:var ue=Vi;case Ki:if(ue||(ue=Hi),L.size!=N.size&&!(ce&qi))return!1;var ge=le.get(L);if(ge)return ge==N;ce|=Wi,le.set(L,N);var de=Yr(ue(L),ue(N),ce,we,te,le);return le.delete(L),de;case to:if(Vt)return Vt.call(L)==Vt.call(N)}return!1}(i,o,h,a,c,d,f);if(!(a&oo)){var P=x&&tn.call(i,"__wrapped__"),T=C&&tn.call(o,"__wrapped__");if(P||T){var z=P?i.value():i,V=T?o.value():o;return f||(f=new xe),d(z,V,a,c,f)}}return!!j&&(f||(f=new xe),function(L,N,G,ce,we,te){var le=G&so,ue=Gt(L),ge=ue.length;if(ge!=Gt(N).length&&!le)return!1;for(var de=ge;de--;){var b=ue[de];if(!(le?b in N:io.call(N,b)))return!1}var l=te.get(L),p=te.get(N);if(l&&p)return l==N&&p==L;var _=!0;te.set(L,N),te.set(N,L);for(var E=le;++de<ge;){var F=L[b=ue[de]],A=N[b];if(ce)var $=le?ce(A,F,b,N,L,te):ce(F,A,b,L,N,te);if(!($===void 0?F===A||we(F,A,G,ce,te):$)){_=!1;break}E||(E=b=="constructor")}if(_&&!E){var Z=L.constructor,D=N.constructor;Z==D||!("constructor"in L)||!("constructor"in N)||typeof Z=="function"&&Z instanceof Z&&typeof D=="function"&&D instanceof D||(_=!1)}return te.delete(L),te.delete(N),_}(i,o,a,c,d,f))}(r,e,t,n,Zt,s))}var ao=1,lo=2;function rn(r){return r==r&&!ze(r)}function nn(r,e){return function(t){return t!=null&&t[r]===e&&(e!==void 0||r in Object(t))}}function co(r,e){return r!=null&&e in Object(r)}var uo=1,ho=2;function $e(r){return typeof r=="function"?r:r==null?St:typeof r=="object"?ie(r)?function(i,o){return qt(i)&&rn(o)?nn(mt(i),o):function(a){var c=function(d,f,w){var m=d==null?void 0:Wt(d,f);return m===void 0?void 0:m}(a,i);return c===void 0&&c===o?function(d,f){return d!=null&&function(w,m,h){for(var y=-1,x=(m=An(m,w)).length,C=!1;++y<x;){var j=mt(m[y]);if(!(C=w!=null&&h(w,j)))break;w=w[j]}return C||++y!=x?C:!!(x=w==null?0:w.length)&&sr(x)&&rr(j,x)&&(ie(w)||or(w))}(d,f,co)}(a,i):Zt(o,c,uo|ho)}}(r[0],r[1]):(s=function(i){for(var o=it(i),a=o.length;a--;){var c=o[a],d=i[c];o[a]=[c,d,rn(d)]}return o}(n=r),s.length==1&&s[0][2]?nn(s[0][0],s[0][1]):function(i){return i===n||function(o,a,c,d){var f=c.length,w=f;if(o==null)return!w;for(o=Object(o);f--;){var m=c[f];if(m[2]?m[1]!==o[m[0]]:!(m[0]in o))return!1}for(;++f<w;){var h=(m=c[f])[0],y=o[h],x=m[1];if(m[2]){if(y===void 0&&!(h in o))return!1}else{var C=new xe;if(!Zt(x,y,ao|lo,void 0,C))return!1}}return!0}(i,0,s)}):qt(e=r)?(t=mt(e),function(i){return i==null?void 0:i[t]}):function(i){return function(o){return Wt(o,i)}}(e);var e,t,n,s}var fo=function(r,e,t){for(var n=-1,s=Object(r),i=t(r),o=i.length;o--;){var a=i[++n];if(e(s[a],a,s)===!1)break}return r};function Rn(r,e){return r&&fo(r,e,it)}var sn,po=(sn=Rn,function(r,e){if(r==null)return r;if(!Je(r))return sn(r,e);for(var t=r.length,n=-1,s=Object(r);++n<t&&e(s[n],n,s)!==!1;);return r});function zn(r,e){var t=-1,n=Je(r)?Array(r.length):[];return po(r,function(s,i,o){n[++t]=e(s,i,o)}),n}function go(r,e){return r>e}var mo=Math.min;function vo(r){return function(e){return Me(e)&&Je(e)}(r)?r:[]}var wo=_n(function(r){var e=He(r,vo);return e.length&&e[0]===r[0]?function(t,n,s){for(var i=Rs,o=t[0].length,a=t.length,c=a,d=Array(a),f=1/0,w=[];c--;){var m=t[c];f=mo(m.length,f),d[c]=o>=120&&m.length>=120?new tt(c&&m):void 0}m=t[0];var h=-1,y=d[0];e:for(;++h<o&&w.length<f;){var x=m[h],C=x;if(x=x!==0?x:0,!(y?Yt(y,C):i(w,C,s))){for(c=a;--c;){var j=d[c];if(!(j?Yt(j,C):i(t[c],C,s)))continue e}y&&y.push(C),w.push(x)}}return w}(e):[]}),yo=wo;function bo(r,e){return r<e}function B(r,e){var t={};return e=$e(e),Rn(r,function(n,s,i){nr(t,s,e(n,s,i))}),t}function Tn(r,e,t){for(var n=-1,s=r.length;++n<s;){var i=r[n],o=e(i);if(o!=null&&(a===void 0?o==o&&!qe(o):t(o,a)))var a=o,c=i}return c}function xo(r,e){return r&&r.length?Tn(r,$e(e),go):void 0}function Bn(r,e){for(var t,n=-1,s=r.length;++n<s;){var i=e(r[n]);i!==void 0&&(t=t===void 0?i:t+i)}return t}function _o(r,e){return function(t,n){var s=t==null?0:t.length;return s?Bn(t,n)/s:NaN}(r,$e(e))}function So(r,e){if(r!==e){var t=r!==void 0,n=r===null,s=r==r,i=qe(r),o=e!==void 0,a=e===null,c=e==e,d=qe(e);if(!a&&!d&&!i&&r>e||i&&o&&c&&!a&&!d||n&&o&&c||!t&&c||!s)return 1;if(!n&&!i&&!d&&r<e||d&&t&&s&&!n&&!i||a&&t&&s||!o&&s||!c)return-1}return 0}function $n(r,e,t){e=e.length?He(e,function(s){return ie(s)?function(i){return Wt(i,s.length===1?s[0]:s)}:s}):[St];var n=-1;return e=He(e,Et($e)),function(s,i){var o=s.length;for(s.sort(function(a,c){return function(d,f,w){for(var m=-1,h=d.criteria,y=f.criteria,x=h.length,C=w.length;++m<x;){var j=So(h[m],y[m]);if(j)return m>=C?j:j*(w[m]=="desc"?-1:1)}return d.index-f.index}(a,c,t)});o--;)s[o]=s[o].value;return s}(zn(r,function(s,i,o){return{criteria:He(e,function(a){return a(s)}),index:++n,value:s}}))}function ur(r,e,t,n){return r==null?[]:(ie(e)||(e=e==null?[]:[e]),ie(t=t)||(t=t==null?[]:[t]),$n(r,e,t))}var Co=_n(function(r,e){if(r==null)return[];var t=e.length;return t>1&&Lr(r,e[0],e[1])?e=[]:t>2&&Lr(e[0],e[1],e[2])&&(e=[e[0]]),$n(r,si(e),[])});function Eo(r,e){return r&&r.length?Bn(r,$e(e)):0}function R(r){if(this.words=[],r)if(Symbol&&Symbol.iterator&&r[Symbol.iterator]!==void 0){const e=r[Symbol.iterator]();let t=e.next();for(;!t.done;)this.add(t.value),t=e.next()}else for(let e=0;e<r.length;e++)this.add(r[e])}R.fromWords=function(r){const e=Object.create(R.prototype);return e.words=r,e},R.prototype.add=function(r){this.resize(r),this.words[r>>>5]|=1<<r},R.prototype.flip=function(r){this.resize(r),this.words[r>>>5]^=1<<r},R.prototype.clear=function(){this.words.length=0},R.prototype.remove=function(r){this.resize(r),this.words[r>>>5]&=~(1<<r)},R.prototype.isEmpty=function(r){const e=this.words.length;for(let t=0;t<e;t++)if(this.words[t]!==0)return!1;return!0},R.prototype.has=function(r){return(this.words[r>>>5]&1<<r)!=0},R.prototype.checkedAdd=function(r){this.resize(r);const e=this.words[r>>>5],t=e|1<<r;return this.words[r>>>5]=t,(t^e)>>>r},R.prototype.trim=function(r){let e=this.words.length;for(;e>0&&this.words[e-1]===0;)e--;this.words.length=e},R.prototype.resize=function(r){const e=r+32>>>5;for(let t=this.words.length;t<e;t++)this.words[t]=0},R.prototype.hammingWeight=function(r){return 16843009*((r=(858993459&(r-=r>>>1&1431655765))+(r>>>2&858993459))+(r>>>4)&252645135)>>>24},R.prototype.hammingWeight4=function(r,e,t,n){return 16843009*((r=(r=(858993459&(r-=r>>>1&1431655765))+(r>>>2&858993459))+(r>>>4)&252645135)+(e=(e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)+(t=(t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)+(n=(n=(858993459&(n-=n>>>1&1431655765))+(n>>>2&858993459))+(n>>>4)&252645135))>>>24},R.prototype.size=function(){let r=0;const e=this.words.length,t=this.words;for(let n=0;n<e;n++)r+=this.hammingWeight(t[n]);return r},R.prototype.array=function(){const r=new Array(this.size());let e=0;const t=this.words.length;for(let n=0;n<t;++n){let s=this.words[n];for(;s!=0;){const i=s&-s;r[e++]=(n<<5)+this.hammingWeight(i-1|0),s^=i}}return r},R.prototype.forEach=function(r){const e=this.words.length;for(let t=0;t<e;++t){let n=this.words[t];for(;n!=0;){const s=n&-n;r((t<<5)+this.hammingWeight(s-1|0)),n^=s}}},R.prototype[Symbol.iterator]=function(){const r=this.words.length;let e=0,t=this.words[e],n=this.hammingWeight,s=this.words;return{[Symbol.iterator](){return this},next(){for(;e<r;){if(t!==0){const i=t&-t,o=(e<<5)+n(i-1|0);return t^=i,{done:!1,value:o}}e++,e<r&&(t=s[e])}return{done:!0,value:void 0}}}},R.prototype.clone=function(){const r=Object.create(R.prototype);return r.words=this.words.slice(),r},R.prototype.intersects=function(r){const e=Math.min(this.words.length,r.words.length);for(let t=0;t<e;++t)if(this.words[t]&r.words[t])return!0;return!1},R.prototype.intersection=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(;t+7<e;t+=8)this.words[t]&=r.words[t],this.words[t+1]&=r.words[t+1],this.words[t+2]&=r.words[t+2],this.words[t+3]&=r.words[t+3],this.words[t+4]&=r.words[t+4],this.words[t+5]&=r.words[t+5],this.words[t+6]&=r.words[t+6],this.words[t+7]&=r.words[t+7];for(;t<e;++t)this.words[t]&=r.words[t];const n=this.words.length;for(t=e;t<n;++t)this.words[t]=0;return this},R.prototype.intersection_size=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(let n=0;n<e;++n)t+=this.hammingWeight(this.words[n]&r.words[n]);return t},R.prototype.new_intersection=function(r){const e=Object.create(R.prototype),t=Math.min(this.words.length,r.words.length);e.words=new Array(t);let n=0;for(;n+7<t;n+=8)e.words[n]=this.words[n]&r.words[n],e.words[n+1]=this.words[n+1]&r.words[n+1],e.words[n+2]=this.words[n+2]&r.words[n+2],e.words[n+3]=this.words[n+3]&r.words[n+3],e.words[n+4]=this.words[n+4]&r.words[n+4],e.words[n+5]=this.words[n+5]&r.words[n+5],e.words[n+6]=this.words[n+6]&r.words[n+6],e.words[n+7]=this.words[n+7]&r.words[n+7];for(;n<t;++n)e.words[n]=this.words[n]&r.words[n];return e},R.prototype.equals=function(r){const e=Math.min(this.words.length,r.words.length);for(let t=0;t<e;++t)if(this.words[t]!=r.words[t])return!1;if(this.words.length<r.words.length){const t=r.words.length;for(let n=this.words.length;n<t;++n)if(r.words[n]!=0)return!1}else if(r.words.length<this.words.length){const t=this.words.length;for(let n=r.words.length;n<t;++n)if(this.words[n]!=0)return!1}return!0},R.prototype.difference=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(;t+7<e;t+=8)this.words[t]&=~r.words[t],this.words[t+1]&=~r.words[t+1],this.words[t+2]&=~r.words[t+2],this.words[t+3]&=~r.words[t+3],this.words[t+4]&=~r.words[t+4],this.words[t+5]&=~r.words[t+5],this.words[t+6]&=~r.words[t+6],this.words[t+7]&=~r.words[t+7];for(;t<e;++t)this.words[t]&=~r.words[t];return this},R.prototype.new_difference=function(r){return this.clone().difference(r)},R.prototype.difference2=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(;t+7<e;t+=8)r.words[t]=this.words[t]&~r.words[t],r.words[t+1]=this.words[t+1]&~r.words[t+1],r.words[t+2]=this.words[t+2]&~r.words[t+2],r.words[t+3]=this.words[t+3]&~r.words[t+3],r.words[t+4]=this.words[t+4]&~r.words[t+4],r.words[t+5]=this.words[t+5]&~r.words[t+5],r.words[t+6]=this.words[t+6]&~r.words[t+6],r.words[t+7]=this.words[t+7]&~r.words[t+7];for(;t<e;++t)r.words[t]=this.words[t]&~r.words[t];for(t=this.words.length-1;t>=e;--t)r.words[t]=this.words[t];return r.words.length=this.words.length,r},R.prototype.difference_size=function(r){const e=Math.min(this.words.length,r.words.length);let t=0,n=0;for(;n<e;++n)t+=this.hammingWeight(this.words[n]&~r.words[n]);const s=this.words.length;for(;n<s;++n)t+=this.hammingWeight(this.words[n]);return t},R.prototype.change=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(;t+7<e;t+=8)this.words[t]^=r.words[t],this.words[t+1]^=r.words[t+1],this.words[t+2]^=r.words[t+2],this.words[t+3]^=r.words[t+3],this.words[t+4]^=r.words[t+4],this.words[t+5]^=r.words[t+5],this.words[t+6]^=r.words[t+6],this.words[t+7]^=r.words[t+7];for(;t<e;++t)this.words[t]^=r.words[t];for(t=r.words.length-1;t>=e;--t)this.words[t]=r.words[t];return this},R.prototype.new_change=function(r){const e=Object.create(R.prototype),t=Math.max(this.words.length,r.words.length);e.words=new Array(t);const n=Math.min(this.words.length,r.words.length);let s=0;for(;s+7<n;s+=8)e.words[s]=this.words[s]^r.words[s],e.words[s+1]=this.words[s+1]^r.words[s+1],e.words[s+2]=this.words[s+2]^r.words[s+2],e.words[s+3]=this.words[s+3]^r.words[s+3],e.words[s+4]=this.words[s+4]^r.words[s+4],e.words[s+5]=this.words[s+5]^r.words[s+5],e.words[s+6]=this.words[s+6]^r.words[s+6],e.words[s+7]=this.words[s+7]^r.words[s+7];for(;s<n;++s)e.words[s]=this.words[s]^r.words[s];const i=this.words.length;for(s=n;s<i;++s)e.words[s]=this.words[s];const o=r.words.length;for(s=n;s<o;++s)e.words[s]=r.words[s];return e},R.prototype.change_size=function(r){const e=Math.min(this.words.length,r.words.length);let t=0,n=0;for(;n<e;++n)t+=this.hammingWeight(this.words[n]^r.words[n]);const s=this.words.length>r.words.length?this:r,i=s.words.length;for(;n<i;++n)t+=this.hammingWeight(s.words[n]);return t},R.prototype.toString=function(){return"{"+this.array().join(",")+"}"},R.prototype.union=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(;t+7<e;t+=8)this.words[t]|=r.words[t],this.words[t+1]|=r.words[t+1],this.words[t+2]|=r.words[t+2],this.words[t+3]|=r.words[t+3],this.words[t+4]|=r.words[t+4],this.words[t+5]|=r.words[t+5],this.words[t+6]|=r.words[t+6],this.words[t+7]|=r.words[t+7];for(;t<e;++t)this.words[t]|=r.words[t];if(this.words.length<r.words.length){this.resize((r.words.length<<5)-1);const n=r.words.length;for(let s=e;s<n;++s)this.words[s]=r.words[s]}return this},R.prototype.new_union=function(r){const e=Object.create(R.prototype),t=Math.max(this.words.length,r.words.length);e.words=new Array(t);const n=Math.min(this.words.length,r.words.length);let s=0;for(;s+7<n;s+=8)e.words[s]=this.words[s]|r.words[s],e.words[s+1]=this.words[s+1]|r.words[s+1],e.words[s+2]=this.words[s+2]|r.words[s+2],e.words[s+3]=this.words[s+3]|r.words[s+3],e.words[s+4]=this.words[s+4]|r.words[s+4],e.words[s+5]=this.words[s+5]|r.words[s+5],e.words[s+6]=this.words[s+6]|r.words[s+6],e.words[s+7]=this.words[s+7]|r.words[s+7];for(;s<n;++s)e.words[s]=this.words[s]|r.words[s];const i=this.words.length;for(s=n;s<i;++s)e.words[s]=this.words[s];const o=r.words.length;for(s=n;s<o;++s)e.words[s]=r.words[s];return e},R.prototype.union_size=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(let n=0;n<e;++n)t+=this.hammingWeight(this.words[n]|r.words[n]);if(this.words.length<r.words.length){const n=r.words.length;for(let s=this.words.length;s<n;++s)t+=this.hammingWeight(0|r.words[s])}else{const n=this.words.length;for(let s=r.words.length;s<n;++s)t+=this.hammingWeight(0|this.words[s])}return t};var ae=R;function Kt(){return Kt=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Kt.apply(this,arguments)}function Mo(r,e){var t=[];return r.forEach(function(n){e.forEach(function(s){t.push(n.concat(s))})}),t}function Dn(r){return!!~r.search(/\(|\)/)}function on(r,e){for(var t=e.split(" "+r+" "),n=[],s=[],i=0;i<t.length;i++)if(Dn(t[i])||s.length>0){s.push(t[i]);var o=""+s;(o.match(/\(/g)||[]).length===(o.match(/\)/g)||[]).length&&(n.push(s.join(" "+r+" ")),s=[])}else n.push(t[i]);return n}var ko=function r(e){return function(n){for(var s=n[0],i=1;i<n.length;i++)s=s.concat(n[i]);return s}(on("OR",(t=e=function(n){if(n.charAt(0)==="("){for(var s=0,i=0;i<n.length;i++)if(n.charAt(i)==="("?s++:n.charAt(i)===")"&&s--,s===0)return i!==n.length-1?n:n.substring(1,n.length-1)}return n}(e),e=t.replace(/[\s]+/g," "))).map(function(n){for(var s=on("AND",n),i=[],o=[],a=0;a<s.length;a++)Dn(s[a])?i.push(r(s[a])):o.push(s[a]);return i.push([o]),function(c){for(var d=[[]],f=0;f<c.length;f++)d=Mo(d,c[f]);return d}(i)}));var t};const an=function(r){try{return structuredClone(r)}catch{try{return JSON.parse(JSON.stringify(r))}catch{return r}}},ln=function(r,e){let t=new ae([]),n=0;return B(e,function(s,i){s.forEach(o=>{++n,t=t.new_union(r[i][o]||new ae([]))})}),n===0?null:t},Fo=function(r,e,t){let n=1;return B(r.bits_data_temp,(s,i)=>{let o,a,c,d,f,w,m;t[i]&&(o=t[i].order,a=t[i].sort,c=t[i].size,d=t[i].title,f=t[i].show_facet_stats||!1,w=t[i].chosen_filters_on_top!==!1,m=t[i].hide_zero_doc_count||!1);let h,y,x,C,j=Object.entries(s).map(z=>{let V=[];e&&e.filters&&e.filters[i]&&(V=e.filters[i]);const L=z[1].array().length;if(!m||L!==0||V.indexOf(z[0])!==-1)return{key:z[0],doc_count:L,selected:V.indexOf(z[0])!==-1}}).filter(Boolean);var P,T;return ie(a)?(h=a||["key"],y=o||["asc"]):(a==="term"||a==="key"?(h=["key"],y=[o||"asc"]):(h=["doc_count","key"],y=[o||"desc","asc"]),w&&(h.unshift("selected"),y.unshift("desc"))),j=ur(j,h,y),j=j.slice(0,c||10),f&&(x=[],Object.entries(s).forEach(z=>{if(isNaN(z[0]))throw new Error("You cant use chars to calculate the facet_stats.");z[1].array().length>0&&z[1].forEach(()=>{x.push(parseInt(z[0]))})}),C={min:(P=x,P&&P.length?Tn(P,$e(void 0),bo):void 0),max:xo(x),avg:_o(x),sum:Eo(x)}),Kt({name:i,title:d||(T=i,T.replace(/^[\s_]+|[\s_]+$/g,"").replace(/[_\s]+/g," ").replace(/^[a-z]/,function(z){return z.toUpperCase()})),position:n++,buckets:j},f&&{facet_stats:C})})};function cn(r,e,t,n,s){e=e||Object.create(null);const i=parseInt(e.per_page||12),o=parseInt(e.page||1),a=e.is_all_filtered_items||!1;if(t.native_search_enabled===!1&&(e.query||e.filter))throw new Error('"query" and "filter" options are not working once native search is disabled');let c=0;const d=new Date().getTime();let f,w,m,h=s.bits_ids();if(e._ids)f=new ae(e._ids),w=e._ids;else if(e.ids)w=s.internal_ids_from_ids_map(e.ids),f=new ae(w);else if(n&&(e.query||e.filter)){const L=new Date().getTime();w=n.search(e.query,e.filter),c=new Date().getTime()-L,f=new ae(w)}let y=new Date().getTime();const x=s.search(e,{query_ids:f});y=new Date().getTime()-y,f&&(h=f),x.ids&&(h=h.new_intersection(x.ids)),x.not_ids&&(h=h.new_difference(x.not_ids));let C=h.array(),j=C.map(L=>s.get_item(L)),P=!1;const T=new Date().getTime();let z=0;e.sort?j=function(L,N,G){return G&&G[N]&&(N=G[N]),N.field?ur(L,N.field,N.order||"asc"):L}(j,e.sort,t.sortings):w&&(C=w.filter(L=>h.has(L)),j=C.slice((o-1)*i,o*i).map(L=>s.get_item(L)),P=!0),P||(m=a?j:null,j=j.slice((o-1)*i,o*i)),z=new Date().getTime()-T;const V=new Date().getTime()-d;return{pagination:{per_page:i,page:o,total:C.length},timings:{total:V,facets:y,search:c,sorting:z},data:{items:j,allFilteredItems:m,aggregations:Fo(x,e,t.aggregations)}}}var gt=function(r){var e={exports:{}};return function(t,n){(function(){var s,i,o,a,c,d,f,w,m,h,y,x,C,j,P,T,z,V,L,N,G,ce,we,te,le,ue,ge,de,b=function(l){var p=new b.Index;return p.pipeline.add(b.trimmer,b.stopWordFilter,b.stemmer),l&&l.call(p,p),p};b.version="1.0.0",b.utils={},b.utils.warn=function(l){return function(p){l.console&&console.warn&&console.warn(p)}}(this),b.utils.asString=function(l){return l==null?"":l.toString()},b.EventEmitter=function(){this.events={}},b.EventEmitter.prototype.addListener=function(){var l=Array.prototype.slice.call(arguments),p=l.pop(),_=l;if(typeof p!="function")throw new TypeError("last argument must be a function");_.forEach(function(E){this.hasHandler(E)||(this.events[E]=[]),this.events[E].push(p)},this)},b.EventEmitter.prototype.removeListener=function(l,p){if(this.hasHandler(l)){var _=this.events[l].indexOf(p);this.events[l].splice(_,1),this.events[l].length||delete this.events[l]}},b.EventEmitter.prototype.emit=function(l){if(this.hasHandler(l)){var p=Array.prototype.slice.call(arguments,1);this.events[l].forEach(function(_){_.apply(void 0,p)})}},b.EventEmitter.prototype.hasHandler=function(l){return l in this.events},b.tokenizer=function(l){return arguments.length&&l!=null&&l!=null?Array.isArray(l)?l.map(function(p){return b.utils.asString(p).toLowerCase()}):l.toString().trim().toLowerCase().split(b.tokenizer.separator):[]},b.tokenizer.separator=/[\s\-]+/,b.tokenizer.load=function(l){var p=this.registeredFunctions[l];if(!p)throw new Error("Cannot load un-registered function: "+l);return p},b.tokenizer.label="default",b.tokenizer.registeredFunctions={default:b.tokenizer},b.tokenizer.registerFunction=function(l,p){p in this.registeredFunctions&&b.utils.warn("Overwriting existing tokenizer: "+p),l.label=p,this.registeredFunctions[p]=l},b.Pipeline=function(){this._stack=[]},b.Pipeline.registeredFunctions={},b.Pipeline.registerFunction=function(l,p){p in this.registeredFunctions&&b.utils.warn("Overwriting existing registered function: "+p),l.label=p,b.Pipeline.registeredFunctions[l.label]=l},b.Pipeline.warnIfFunctionNotRegistered=function(l){l.label&&l.label in this.registeredFunctions||b.utils.warn(`Function is not registered with pipeline. This may cause problems when serialising the index.
`,l)},b.Pipeline.load=function(l){var p=new b.Pipeline;return l.forEach(function(_){var E=b.Pipeline.registeredFunctions[_];if(!E)throw new Error("Cannot load un-registered function: "+_);p.add(E)}),p},b.Pipeline.prototype.add=function(){Array.prototype.slice.call(arguments).forEach(function(l){b.Pipeline.warnIfFunctionNotRegistered(l),this._stack.push(l)},this)},b.Pipeline.prototype.after=function(l,p){b.Pipeline.warnIfFunctionNotRegistered(p);var _=this._stack.indexOf(l);if(_==-1)throw new Error("Cannot find existingFn");this._stack.splice(_+=1,0,p)},b.Pipeline.prototype.before=function(l,p){b.Pipeline.warnIfFunctionNotRegistered(p);var _=this._stack.indexOf(l);if(_==-1)throw new Error("Cannot find existingFn");this._stack.splice(_,0,p)},b.Pipeline.prototype.remove=function(l){var p=this._stack.indexOf(l);p!=-1&&this._stack.splice(p,1)},b.Pipeline.prototype.run=function(l){for(var p=[],_=l.length,E=this._stack.length,F=0;F<_;F++){for(var A=l[F],$=0;$<E&&(A=this._stack[$](A,F,l))!==void 0&&A!=="";$++);A!==void 0&&A!==""&&p.push(A)}return p},b.Pipeline.prototype.reset=function(){this._stack=[]},b.Pipeline.prototype.toJSON=function(){return this._stack.map(function(l){return b.Pipeline.warnIfFunctionNotRegistered(l),l.label})},b.Vector=function(){this._magnitude=null,this.list=void 0,this.length=0},b.Vector.Node=function(l,p,_){this.idx=l,this.val=p,this.next=_},b.Vector.prototype.insert=function(l,p){this._magnitude=void 0;var _=this.list;if(!_)return this.list=new b.Vector.Node(l,p,_),this.length++;if(l<_.idx)return this.list=new b.Vector.Node(l,p,_),this.length++;for(var E=_,F=_.next;F!=null;){if(l<F.idx)return E.next=new b.Vector.Node(l,p,F),this.length++;E=F,F=F.next}return E.next=new b.Vector.Node(l,p,F),this.length++},b.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;for(var l,p=this.list,_=0;p;)_+=(l=p.val)*l,p=p.next;return this._magnitude=Math.sqrt(_)},b.Vector.prototype.dot=function(l){for(var p=this.list,_=l.list,E=0;p&&_;)p.idx<_.idx?p=p.next:(p.idx>_.idx||(E+=p.val*_.val,p=p.next),_=_.next);return E},b.Vector.prototype.similarity=function(l){return this.dot(l)/(this.magnitude()*l.magnitude())},b.SortedSet=function(){this.length=0,this.elements=[]},b.SortedSet.load=function(l){var p=new this;return p.elements=l,p.length=l.length,p},b.SortedSet.prototype.add=function(){var l,p;for(l=0;l<arguments.length;l++)~this.indexOf(p=arguments[l])||this.elements.splice(this.locationFor(p),0,p);this.length=this.elements.length},b.SortedSet.prototype.toArray=function(){return this.elements.slice()},b.SortedSet.prototype.map=function(l,p){return this.elements.map(l,p)},b.SortedSet.prototype.forEach=function(l,p){return this.elements.forEach(l,p)},b.SortedSet.prototype.indexOf=function(l){for(var p=0,_=this.elements.length,E=_-p,F=p+Math.floor(E/2),A=this.elements[F];E>1;){if(A===l)return F;A<l&&(p=F),A>l&&(_=F),E=_-p,F=p+Math.floor(E/2),A=this.elements[F]}return A===l?F:-1},b.SortedSet.prototype.locationFor=function(l){for(var p=0,_=this.elements.length,E=_-p,F=p+Math.floor(E/2),A=this.elements[F];E>1;)A<l&&(p=F),A>l&&(_=F),E=_-p,F=p+Math.floor(E/2),A=this.elements[F];return A>l?F:A<l?F+1:void 0},b.SortedSet.prototype.intersect=function(l){for(var p=new b.SortedSet,_=0,E=0,F=this.length,A=l.length,$=this.elements,Z=l.elements;!(_>F-1||E>A-1);)$[_]!==Z[E]?$[_]<Z[E]?_++:$[_]>Z[E]&&E++:(p.add($[_]),_++,E++);return p},b.SortedSet.prototype.clone=function(){var l=new b.SortedSet;return l.elements=this.toArray(),l.length=l.elements.length,l},b.SortedSet.prototype.union=function(l){var p,_,E;this.length>=l.length?(p=this,_=l):(p=l,_=this),E=p.clone();for(var F=0,A=_.toArray();F<A.length;F++)E.add(A[F]);return E},b.SortedSet.prototype.toJSON=function(){return this.toArray()},b.Index=function(){this._fields=[],this._ref="id",this.pipeline=new b.Pipeline,this.documentStore=new b.Store,this.tokenStore=new b.TokenStore,this.corpusTokens=new b.SortedSet,this.eventEmitter=new b.EventEmitter,this.tokenizerFn=b.tokenizer,this._idfCache={},this.on("add","remove","update",(function(){this._idfCache={}}).bind(this))},b.Index.prototype.on=function(){var l=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,l)},b.Index.prototype.off=function(l,p){return this.eventEmitter.removeListener(l,p)},b.Index.load=function(l){l.version!==b.version&&b.utils.warn("version mismatch: current "+b.version+" importing "+l.version);var p=new this;return p._fields=l.fields,p._ref=l.ref,p.tokenizer(b.tokenizer.load(l.tokenizer)),p.documentStore=b.Store.load(l.documentStore),p.tokenStore=b.TokenStore.load(l.tokenStore),p.corpusTokens=b.SortedSet.load(l.corpusTokens),p.pipeline=b.Pipeline.load(l.pipeline),p},b.Index.prototype.field=function(l,p){return this._fields.push({name:l,boost:(p=p||{}).boost||1}),this},b.Index.prototype.ref=function(l){return this._ref=l,this},b.Index.prototype.tokenizer=function(l){return l.label&&l.label in b.tokenizer.registeredFunctions||b.utils.warn("Function is not a registered tokenizer. This may cause problems when serialising the index"),this.tokenizerFn=l,this},b.Index.prototype.add=function(l,p){var _={},E=new b.SortedSet,F=l[this._ref];p=p===void 0||p,this._fields.forEach(function(De){var ke=this.pipeline.run(this.tokenizerFn(l[De.name]));_[De.name]=ke;for(var Fe=0;Fe<ke.length;Fe++){var Ae=ke[Fe];E.add(Ae),this.corpusTokens.add(Ae)}},this),this.documentStore.set(F,E);for(var A=0;A<E.length;A++){for(var $=E.elements[A],Z=0,D=0;D<this._fields.length;D++){var ye=this._fields[D],Le=_[ye.name],he=Le.length;if(he){for(var be=0,Se=0;Se<he;Se++)Le[Se]===$&&be++;Z+=be/he*ye.boost}}this.tokenStore.add($,{ref:F,tf:Z})}p&&this.eventEmitter.emit("add",l,this)},b.Index.prototype.remove=function(l,p){var _=l[this._ref];if(p=p===void 0||p,this.documentStore.has(_)){var E=this.documentStore.get(_);this.documentStore.remove(_),E.forEach(function(F){this.tokenStore.remove(F,_)},this),p&&this.eventEmitter.emit("remove",l,this)}},b.Index.prototype.update=function(l,p){p=p===void 0||p,this.remove(l,!1),this.add(l,!1),p&&this.eventEmitter.emit("update",l,this)},b.Index.prototype.idf=function(l){var p="@"+l;if(Object.prototype.hasOwnProperty.call(this._idfCache,p))return this._idfCache[p];var _=this.tokenStore.count(l),E=1;return _>0&&(E=1+Math.log(this.documentStore.length/_)),this._idfCache[p]=E},b.Index.prototype.search=function(l){var p=this.pipeline.run(this.tokenizerFn(l)),_=new b.Vector,E=[],F=this._fields.reduce(function(A,$){return A+$.boost},0);return p.some(function(A){return this.tokenStore.has(A)},this)?(p.forEach(function(A,$,Z){var D=1/Z.length*this._fields.length*F,ye=this,Le=this.tokenStore.expand(A).reduce(function(he,be){var Se=ye.corpusTokens.indexOf(be),De=ye.idf(be),ke=1,Fe=new b.SortedSet;if(be!==A){var Ae=Math.max(3,be.length-A.length);ke=1/Math.log(Ae)}Se>-1&&_.insert(Se,D*De*ke);for(var Ue=ye.tokenStore.get(be),ot=Object.keys(Ue),Ft=ot.length,Qe=0;Qe<Ft;Qe++)Fe.add(Ue[ot[Qe]].ref);return he.union(Fe)},new b.SortedSet);E.push(Le)},this),E.reduce(function(A,$){return A.intersect($)}).map(function(A){return{ref:A,score:_.similarity(this.documentVector(A))}},this).sort(function(A,$){return $.score-A.score})):[]},b.Index.prototype.documentVector=function(l){for(var p=this.documentStore.get(l),_=p.length,E=new b.Vector,F=0;F<_;F++){var A=p.elements[F],$=this.tokenStore.get(A)[l].tf,Z=this.idf(A);E.insert(this.corpusTokens.indexOf(A),$*Z)}return E},b.Index.prototype.toJSON=function(){return{version:b.version,fields:this._fields,ref:this._ref,tokenizer:this.tokenizerFn.label,documentStore:this.documentStore.toJSON(),tokenStore:this.tokenStore.toJSON(),corpusTokens:this.corpusTokens.toJSON(),pipeline:this.pipeline.toJSON()}},b.Index.prototype.use=function(l){var p=Array.prototype.slice.call(arguments,1);p.unshift(this),l.apply(this,p)},b.Store=function(){this.store={},this.length=0},b.Store.load=function(l){var p=new this;return p.length=l.length,p.store=Object.keys(l.store).reduce(function(_,E){return _[E]=b.SortedSet.load(l.store[E]),_},{}),p},b.Store.prototype.set=function(l,p){this.has(l)||this.length++,this.store[l]=p},b.Store.prototype.get=function(l){return this.store[l]},b.Store.prototype.has=function(l){return l in this.store},b.Store.prototype.remove=function(l){this.has(l)&&(delete this.store[l],this.length--)},b.Store.prototype.toJSON=function(){return{store:this.store,length:this.length}},b.stemmer=(s={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},i={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},d="^("+(a="[^aeiou][^aeiouy]*")+")?"+(c=(o="[aeiouy]")+"[aeiou]*")+a+"("+c+")?$",f="^("+a+")?"+c+a+c+a,w="^("+a+")?"+o,m=new RegExp("^("+a+")?"+c+a),h=new RegExp(f),y=new RegExp(d),x=new RegExp(w),C=/^(.+?)(ss|i)es$/,j=/^(.+?)([^s])s$/,P=/^(.+?)eed$/,T=/^(.+?)(ed|ing)$/,z=/.$/,V=/(at|bl|iz)$/,L=new RegExp("([^aeiouylsz])\\1$"),N=new RegExp("^"+a+o+"[^aeiouwxy]$"),G=/^(.+?[^aeiou])y$/,ce=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,we=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,te=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,le=/^(.+?)(s|t)(ion)$/,ue=/^(.+?)e$/,ge=/ll$/,de=new RegExp("^"+a+o+"[^aeiouwxy]$"),function(l){var p,_,E,F,A,$,Z;if(l.length<3)return l;if((E=l.substr(0,1))=="y"&&(l=E.toUpperCase()+l.substr(1)),A=j,(F=C).test(l)?l=l.replace(F,"$1$2"):A.test(l)&&(l=l.replace(A,"$1$2")),A=T,(F=P).test(l)){var D=F.exec(l);(F=m).test(D[1])&&(l=l.replace(F=z,""))}else A.test(l)&&(D=A.exec(l),(A=x).test(p=D[1])&&($=L,Z=N,(A=V).test(l=p)?l+="e":$.test(l)?l=l.replace(F=z,""):Z.test(l)&&(l+="e")));return(F=G).test(l)&&(l=(p=(D=F.exec(l))[1])+"i"),(F=ce).test(l)&&(_=(D=F.exec(l))[2],(F=m).test(p=D[1])&&(l=p+s[_])),(F=we).test(l)&&(_=(D=F.exec(l))[2],(F=m).test(p=D[1])&&(l=p+i[_])),A=le,(F=te).test(l)?(D=F.exec(l),(F=h).test(p=D[1])&&(l=p)):A.test(l)&&(D=A.exec(l),(A=h).test(p=D[1]+D[2])&&(l=p)),(F=ue).test(l)&&(D=F.exec(l),A=y,$=de,((F=h).test(p=D[1])||A.test(p)&&!$.test(p))&&(l=p)),A=h,(F=ge).test(l)&&A.test(l)&&(l=l.replace(F=z,"")),E=="y"&&(l=E.toLowerCase()+l.substr(1)),l}),b.Pipeline.registerFunction(b.stemmer,"stemmer"),b.generateStopWordFilter=function(l){var p=l.reduce(function(_,E){return _[E]=E,_},{});return function(_){if(_&&p[_]!==_)return _}},b.stopWordFilter=b.generateStopWordFilter(["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"]),b.Pipeline.registerFunction(b.stopWordFilter,"stopWordFilter"),b.trimmer=function(l){return l.replace(/^\W+/,"").replace(/\W+$/,"")},b.Pipeline.registerFunction(b.trimmer,"trimmer"),b.TokenStore=function(){this.root={docs:{}},this.length=0},b.TokenStore.load=function(l){var p=new this;return p.root=l.root,p.length=l.length,p},b.TokenStore.prototype.add=function(l,p,_){_=_||this.root;var E=l.charAt(0),F=l.slice(1);return E in _||(_[E]={docs:{}}),F.length===0?(_[E].docs[p.ref]=p,void(this.length+=1)):this.add(F,p,_[E])},b.TokenStore.prototype.has=function(l){if(!l)return!1;for(var p=this.root,_=0;_<l.length;_++){if(!p[l.charAt(_)])return!1;p=p[l.charAt(_)]}return!0},b.TokenStore.prototype.getNode=function(l){if(!l)return{};for(var p=this.root,_=0;_<l.length;_++){if(!p[l.charAt(_)])return{};p=p[l.charAt(_)]}return p},b.TokenStore.prototype.get=function(l,p){return this.getNode(l,p).docs||{}},b.TokenStore.prototype.count=function(l,p){return Object.keys(this.get(l,p)).length},b.TokenStore.prototype.remove=function(l,p){if(l){for(var _=this.root,E=0;E<l.length;E++){if(!(l.charAt(E)in _))return;_=_[l.charAt(E)]}delete _.docs[p]}},b.TokenStore.prototype.expand=function(l,p){var _=this.getNode(l);return p=p||[],Object.keys(_.docs||{}).length&&p.push(l),Object.keys(_).forEach(function(E){E!=="docs"&&p.concat(this.expand(l+E,p))},this),p},b.TokenStore.prototype.toJSON=function(){return{root:this.root,length:this.length}},t.exports=b})()}(e),e.exports}();class un{constructor(e,t){this.store=new Map,this.idx=gt(function(){this.field("name",{boost:10}),((t==null?void 0:t.searchableFields)||[]).forEach(s=>this.field(s)),this.ref("_id"),t!=null&&t.isExactSearch&&(this.pipeline.remove(gt.stemmer),this.pipeline.remove(gt.stopWordFilter)),t!=null&&t.removeStopWordFilter&&this.pipeline.remove(gt.stopWordFilter)});let n=1;(e||[]).map(s=>{s._id=n,++n,this.idx.add(s),this.store.set(s._id,s)})}search_full(e,t){return this.search(e,t).map(n=>this.store.get(n))}search(e,t){return t instanceof Function?(e?this.idx.search(e).map(n=>this.store.get(n.ref)):[...this.store.values()]).filter(t).map(n=>n._id):e?this.idx.search(e).map(n=>n.ref):[...this.store.keys()]}}class dn{constructor(e,t){(t=t||Object.create(null)).aggregations=t.aggregations||Object.create(null),this._items=e,this.config=t.aggregations,this.facets=function(o,a){a=a||[];const c={data:Object.create(null),bits_data:Object.create(null),bits_data_temp:Object.create(null)};let d=1;return a.forEach(f=>{c.data[f]=Object.create(null)}),o&&o.map(f=>(f._id||(f._id=d,++d),f)),o&&o.map(f=>(a.forEach(w=>{if(f){if(Array.isArray(f[w]))f[w].forEach(m=>{f[w]&&(c.data[w][m]||(c.data[w][m]=[]),c.data[w][m].push(parseInt(f._id)))});else if(f[w]!==void 0){const m=f[w];c.data[w][m]||(c.data[w][m]=[]),c.data[w][m].push(parseInt(f._id))}}}),f)),c.data=B(c.data,function(f,w){return c.bits_data[w]||(c.bits_data[w]=Object.create(null),c.bits_data_temp[w]=Object.create(null)),B(f,function(m,h){const y=Co(m);return c.bits_data[w][h]=new ae(y),y})}),c}(e,it(t.aggregations)),this._items_map=Object.create(null),this._ids=[];let n=1;var s,i;i=o=>{this._ids.push(n),this._items_map[n]=o,o._id=n,++n},(ie(s=e)?He:zn)(s,$e(i)),this.ids_map=Object.create(null),e&&e.forEach(o=>{const a=t.custom_id_field||"id";o[a]&&o._id&&(this.ids_map[o[a]]=o._id)}),this._bits_ids=new ae(this._ids)}items(){return this._items}bits_ids(e){return e?new ae(e):this._bits_ids}internal_ids_from_ids_map(e){return e.map(t=>this.ids_map[t])}index(){return this.facets}get_item(e){return this._items_map[e]}search(e,t){const n=this.config;t=t||Object.create(null);const s=Ut(this.facets);let i;s.not_ids=ln(s.bits_data,e.not_filters);const o=function(a,c){const d=[];return B(a.filters,function(f,w){if(f&&f.length)if(c[w].conjunction!==!1)B(f,function(m){d.push([w,m])});else{const m=[];B(f,function(h){m.push([w,h])}),d.push(m)}}),B(a.not_filters,function(f,w){f&&f.length&&B(f,function(m){d.push([w,"-",m])})}),d}(e,n);return i=function(a,c){const d=Ut(a);let f;c=c||[],B(d.bits_data,function(m,h){B(d.bits_data[h],function(y,x){d.bits_data_temp[h][x]=d.bits_data[h][x]})}),d.is_temp_copied=!0;const w=function(m,h){const y=Object.create(null);return B(h,function(x){if(Array.isArray(x[0])){let C=new ae([]);B(x,function(j){const P=j[0];C=C.new_union(m.bits_data[P][j[1]]||new ae([])),y[P]=C})}}),y}(a,c);return B(c,function(m){if(!Array.isArray(m[0])){const h=m[0],y=m[1];f=f&&d.bits_data_temp[h][y]?d.bits_data_temp[h][y].new_intersection(f):f&&!d.bits_data_temp[h][y]?new ae([]):d.bits_data_temp[h][y]}}),f&&B(d.bits_data_temp,function(m,h){B(d.bits_data_temp[h],function(y,x){d.bits_data_temp[h][x]=d.bits_data_temp[h][x].new_intersection(f)})}),B(c,function(m){if(m.length===3&&m[1]==="-"){const h=d.bits_data_temp[m[0]][m[2]].clone();B(d.bits_data_temp,function(y,x){B(d.bits_data_temp[x],function(C,j){d.bits_data_temp[x][j]=d.bits_data_temp[x][j].new_difference(h)})})}}),B(d.bits_data_temp,function(m,h){B(d.bits_data_temp[h],function(y,x){B(w,function(C,j){j!==h&&(d.bits_data_temp[h][x]=d.bits_data_temp[h][x].new_intersection(C))})})}),d}(this.facets,o),e.filters_query&&(i=function(a,c){const d=Ut(a);d.is_temp_copied||B(d.bits_data,function(w,m){B(d.bits_data[m],function(h,y){d.bits_data_temp[m][y]=d.bits_data[m][y]})});let f=null;return B(c,function(w){let m=null;B(w,function(h){const y=h[0],x=h[1];if(!d.bits_data_temp[y])throw new Error("Panic. The key does not exist in facets lists.");m=m&&d.bits_data_temp[y][x]?d.bits_data_temp[y][x].new_intersection(m):m&&!d.bits_data_temp[y][x]?new ae([]):d.bits_data_temp[y][x]}),f=(f||new ae([])).new_union(m||new ae([]))}),f!==null&&B(d.bits_data_temp,function(w,m){B(d.bits_data_temp[m],function(h,y){d.bits_data_temp[m][y]=d.bits_data_temp[m][y].new_intersection(f)})}),d}(i,ko(e.filters_query).map(a=>Array.isArray(a)?a.map(c=>Array.isArray(c)?c.map(d=>d):c.split(":")):a.split(":")))),s.bits_data_temp=i.bits_data_temp,B(s.bits_data_temp,function(a,c){B(s.bits_data_temp[c],function(d,f){t.query_ids&&(s.bits_data_temp[c][f]=t.query_ids.new_intersection(s.bits_data_temp[c][f])),t.test&&(s.data[c][f]=s.bits_data_temp[c][f].array())})}),s.ids=e.filters_query?function(a){let c=new ae([]);return B(a,function(d,f){B(a[f],function(w,m){c=c.new_union(a[f][m])})}),c}(s.bits_data_temp):ln(s.bits_data_temp,e.filters),s}}function Ao(r,e){let t;(e=e||Object.create(null)).native_search_enabled!==!1&&(t=new un(r,e));let n=new dn(r,e);return{search:function(s){return(s=s||Object.create(null)).aggregations=function(i,o){return B(an(i),(a,c)=>{a.field||(a.field=c);let d=[];o.filters&&o.filters[c]&&(d=o.filters[c]),a.filters=d;let f=[];return o.not_filters&&o.not_filters[c]&&(f=o.not_filters[c]),o.exclude_filters&&o.exclude_filters[c]&&(f=o.exclude_filters[c]),a.not_filters=f,a})}(e.aggregations,s),cn(0,s,e,t,n)},similar:function(s,i){return function(o,a,c){const d=c.per_page||10,f=c.minimum||0,w=c.page||1;let m;for(let x=0;x<o.length;++x)if(o[x].id==a){m=o[x];break}if(!c.field)throw new Error("Please define field in options");const h=c.field;let y=[];for(let x=0;x<o.length;++x)if(o[x].id!==a){const C=yo(m[h],o[x][h]);C.length>=f&&(y.push(o[x]),y[y.length-1].intersection_length=C.length)}return y=ur(y,["intersection_length"],["desc"]),{pagination:{per_page:d,page:w,total:y.length},data:{items:y.slice((w-1)*d,w*d)}}}(r,s,i)},aggregation:function(s){return function(i,o,a,c,d){const f=o.per_page||10,w=o.page||1;if(o.name&&(!a.aggregations||!a.aggregations[o.name]))throw new Error('Please define aggregation "'.concat(o.name,'" in config'));const m=an(o);if(m.page=1,m.per_page=0,!o.name)throw new Error("field name is required");a.aggregations[o.name].size=1e4;const h=cn(0,m,a,c,d).data.aggregations[o.name].buckets;return{pagination:{per_page:f,page:w,total:h.length},data:{buckets:h.slice((w-1)*f,w*f)}}}(0,s,e,t,n)},reindex:function(s){t=new un(r=s,e),n=new dn(r,e)}}}class Oo{constructor(e){this.config=e,this.state={query:"",filters:{},sort:"",bounds:null},this.state.sort=this.config.searchConfig.defaultSort,this.state.filters=this.createEmptyFilters()}createEmptyFilters(){const e={};for(const[t]of Object.entries(this.config.aggregations))e[t]=[];return e}hasActiveFilters(){if(!this.state.filters)return!1;for(const[e,t]of Object.entries(this.state.filters))if(Array.isArray(t)&&t.length>0||!Array.isArray(t)&&t)return!0;return!1}updateFilters(e,t,n){var s;console.log(`Updating filter: ${e}, value: ${t}, checked: ${n}`),n?(this.state.filters[e]||(this.state.filters[e]=[]),this.state.filters[e].includes(t)||this.state.filters[e].push(t)):this.state.filters[e]=((s=this.state.filters[e])==null?void 0:s.filter(i=>i!==t))||[]}async handleStateChange(e,t){console.log("handleStateChange called with action:",e);try{switch(e.type){case"FACET_CHANGE":this.updateFilters(e.facetType,e.value,e.checked);break;case"RANGE_CHANGE":this.state.filters[e.facetKey]=e.value;break;case"QUERY_CHANGE":this.state.query=e.query;break;case"SORT_CHANGE":this.state.sort=e.sort;break}console.log("State updated, triggering search. New state:",this.state),t&&t.onStateChange&&await t.onStateChange(this.state)}catch(n){console.error("Error in handleStateChange:",n)}}getState(){return this.state}setState(e){this.state={...this.state,...e}}}class jo{static debounce(e,t){let n;return function(){clearTimeout(n),n=setTimeout(()=>e.apply(this,arguments),t)}}static parseCoordinates(e){if(!e||typeof e!="string")return{lat:null,lng:null};const t=e.split(",");return t.length===2?{lat:parseFloat(t[0].trim()),lng:parseFloat(t[1].trim())}:{lat:null,lng:null}}static encodeForAttribute(e){return encodeURIComponent(e||"")}static createUniqueId(e="element"){return`${e}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}static isEmpty(e){return e==null?!0:typeof e=="string"?e.trim()==="":Array.isArray(e)?e.length===0:typeof e=="object"?Object.keys(e).length===0:!1}}class Lo{constructor(e,t){this.searchHandler=e,this.config=t,this.isLoading=!1,this.debouncedSearch=jo.debounce(async(n,s)=>{await this.performSearch(n,s)},300)}async performSearch(e,t){var n;try{const s=this.searchHandler.performSearch(e,{onMarkersUpdate:t.onMarkersUpdate,onResultsUpdate:t.onResultsUpdate,onAggregationsUpdate:t.onAggregationsUpdate}),i=this.calculateUniqueResultsCount(s.items);if(t.onNavBarUpdate&&t.onNavBarUpdate(s.items||[]),(((n=s.items)==null?void 0:n.length)||0)>0&&t.onBoundsCalculated){const a=this.calculateBounds(s.items);a&&t.onBoundsCalculated(a)}return s}catch(s){console.error(" Search error:",s),t.onError&&t.onError("Search failed","error")}}calculateBounds(e){if(!e||!Array.isArray(e)||e.length===0)return console.warn(" No items to calculate bounds"),null;let t=1/0,n=-1/0,s=1/0,i=-1/0,o=!1;if(e.forEach((f,w)=>{var y,x,C,j,P,T,z,V,L,N;let m,h;if(f.lat_long){const G=f.lat_long.split(",");G.length===2&&(m=parseFloat(G[0].trim()),h=parseFloat(G[1].trim()))}(!m||!h)&&(m=f.lat||f.latitude||((y=f._source)==null?void 0:y.lat)||((x=f._source)==null?void 0:x.latitude)||((C=f.source)==null?void 0:C.lat)||((j=f.source)==null?void 0:j.latitude),h=f.lng||f.lon||f.longitude||((P=f._source)==null?void 0:P.lng)||((T=f._source)==null?void 0:T.lon)||((z=f._source)==null?void 0:z.longitude)||((V=f.source)==null?void 0:V.lng)||((L=f.source)==null?void 0:L.lon)||((N=f.source)==null?void 0:N.longitude)),m!==void 0&&h!==void 0&&m!==null&&h!==null&&!isNaN(m)&&!isNaN(h)&&m>=-90&&m<=90&&h>=-180&&h<=180&&(t=Math.min(t,m),n=Math.max(n,m),s=Math.min(s,h),i=Math.max(i,h),o=!0)}),!o)return console.warn(" No valid coordinates found for bounds calculation. Skipping map focus."),null;const a=(n-t)*.1||.1,c=(i-s)*.1||.1;return{southwest:[t-a,s-c],northeast:[n+a,i+c],center:{lat:(t+n)/2,lng:(s+i)/2}}}calculateUniqueResultsCount(e){if(!e||!Array.isArray(e))return 0;const t=new Set;return e.forEach(n=>{var i,o,a,c,d,f;const s=n.pivot_ID||n.pivotID||n.pivot_id||((i=n._source)==null?void 0:i.pivot_ID)||((o=n._source)==null?void 0:o.pivotID)||((a=n._source)==null?void 0:a.pivot_id)||((c=n.source)==null?void 0:c.pivot_ID)||((d=n.source)==null?void 0:d.pivotID)||((f=n.source)==null?void 0:f.pivot_id);s!=null&&s!==""&&t.add(s)}),t.size}getLoadingStatus(){return{isLoading:this.isLoading}}}class Io{constructor(){this.fullScreenLoader=null}showFullScreenLoader(){this.fullScreenLoader||(this.fullScreenLoader=document.createElement("div"),this.fullScreenLoader.className="fixed inset-0 z-[9999] bg-white flex items-center justify-center",this.fullScreenLoader.innerHTML=`
        <div class="text-center">
          <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-primary-500 mx-auto mb-4"></div>
          <h2 class="text-xl font-semibold text-gray-700 mb-2">Caricamento ...</h2>
          <p class="text-gray-500">Inizializzazione dei dati, della mappa e dei componenti </p>
        </div>
      `,document.body.appendChild(this.fullScreenLoader)),this.fullScreenLoader.style.display="flex"}hideFullScreenLoader(){this.fullScreenLoader&&(this.fullScreenLoader.style.opacity="0",this.fullScreenLoader.style.transition="opacity 0.3s ease-out",setTimeout(()=>{this.fullScreenLoader&&(this.fullScreenLoader.style.display="none")},300))}showNotification(e,t="info"){const n=document.createElement("div");n.className=`fixed top-4 right-4 z-50 p-3 rounded-lg shadow-lg max-w-sm text-white transition-all duration-300 ${t==="error"?"bg-red-500":t==="warning"?"bg-yellow-500":"bg-blue-500"}`,n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.style.opacity="0",setTimeout(()=>n.remove(),300)},3e3)}showFilterNotification(e,t){const n=document.createElement("div");n.className="fixed top-4 right-4 bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300",n.style.transform="translateX(100%)",n.innerHTML=`
      <div class="flex items-center space-x-3">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
        </svg>
        <span>Filtro applicato: <strong>${e}</strong> = "${t}"</span>
        <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    `,document.body.appendChild(n),setTimeout(()=>{n.style.transform="translateX(0)"},100),setTimeout(()=>{n.style.transform="translateX(100%)",setTimeout(()=>{n.parentElement&&n.parentElement.removeChild(n)},300)},5e3)}}class No{constructor(e,t){this.stateManager=e,this.config=t}applyUrlFilters(e){return new Promise(t=>{const n=new URLSearchParams(window.location.search),s=n.get("filter"),i=n.get("value");if(console.log("Checking URL parameters:",{filterKey:s,filterValue:i}),s&&i)if(console.log(`Applying URL filter: ${s} = ${i}`),this.config.aggregations&&this.config.aggregations[s]){const o=this.config.aggregations[s];let a=i;if(o.type==="range"){const d=i.includes("-")?i.split("-").map(f=>parseInt(f.trim(),10)):i.split(",").map(f=>parseInt(f.trim(),10));if(d.length===2&&!isNaN(d[0])&&!isNaN(d[1]))a=d;else{console.error(`Invalid range format: ${i}`),t();return}}const c=this.stateManager.getState();o.type==="range"?c.filters[s]=a:(c.filters[s]||(c.filters[s]=[]),c.filters[s].includes(a)||c.filters[s].push(a)),this.stateManager.setState(c),console.log("State filters after URL application:",c.filters),setTimeout(async()=>{e.onApplyFilters&&await e.onApplyFilters(),console.log(`Filter applied and search completed: ${s} = ${i}`),e.onShowNotification&&e.onShowNotification(s,i),t()},1500)}else console.warn(`Filter key '${s}' not found in configuration`),e.onError&&e.onError(`Filtro '${s}' non trovato`,"warning"),t();else t()})}clearAllFilters(){const e=this.stateManager.getState();e.query="",e.filters=this.stateManager.createEmptyFilters(),this.stateManager.setState(e);const t=document.getElementById("search-input");t&&(t.value="")}removeFilter(e,t){const n=this.stateManager.getState();n.filters[e]&&(t?n.filters[e]=n.filters[e].filter(s=>s!==t):n.filters[e]=[],this.stateManager.setState(n))}clearSearchQuery(){const e=this.stateManager.getState();e.query="",this.stateManager.setState(e);const t=document.getElementById("search-input");t&&(t.value="")}}class Po{constructor(e,t,n){this.stateManager=e,this.config=t,this.callbacks=n}bindEvents(){this.setupSearchInput(),this.setupSortSelect()}bindNavBarEvents(e){e.addEventListener("clearAllFilters",()=>{this.callbacks.onClearAllFilters&&this.callbacks.onClearAllFilters()}),e.addEventListener("removeFilter",t=>{const{facetKey:n,value:s}=t.detail;this.callbacks.onRemoveFilter&&this.callbacks.onRemoveFilter(n,s)}),e.addEventListener("clearSearchQuery",()=>{this.callbacks.onClearSearchQuery&&this.callbacks.onClearSearchQuery()})}setupSearchInput(){const e=document.getElementById("search-input");e&&e.addEventListener("input",()=>{const t=this.stateManager.getState();t.query=e.value,this.stateManager.setState(t),this.callbacks.onSearch&&this.callbacks.onSearch()})}setupSortSelect(){const e=document.getElementById("sort-select");e&&this.config.searchConfig.sortOptions&&(e.innerHTML=this.config.searchConfig.sortOptions.map(t=>`<option value="${t.value}">${t.label}</option>`).join(""),e.addEventListener("change",t=>{const n=this.stateManager.getState();n.sort=t.target.value,this.stateManager.setState(n),this.callbacks.onSortChange&&this.callbacks.onSortChange()}))}}class Ro{constructor(){this.activeFiltersCount=0,this.mentionsCount=0,this.resultsCount=0,this.uniqueResultsCount=0,this.isFiltersOpen=!0,this.isResultsOpen=!0,this.listeners=new Map}update(e){const t={};Object.entries(e).forEach(([n,s])=>{this[n]!==s&&(t[n]={old:this[n],new:s},this[n]=s)}),Object.keys(t).length>0&&this.notify(t)}subscribe(e){const t=Math.random().toString(36);return this.listeners.set(t,e),()=>this.listeners.delete(t)}notify(e){this.listeners.forEach(t=>t(e))}getSnapshot(){return{activeFiltersCount:this.activeFiltersCount,resultsCount:this.resultsCount,uniqueResultsCount:this.uniqueResultsCount,isFiltersOpen:this.isFiltersOpen,isResultsOpen:this.isResultsOpen}}reset(){this.update({activeFiltersCount:0,mentionsCount:0,resultsCount:0,uniqueResultsCount:0,isFiltersOpen:!0,isResultsOpen:!0})}get state(){return this.getSnapshot()}}const Ve={MOBILE_BREAKPOINT:768,DEBOUNCE_DELAY:150,HAMBURGER_ID:"hamburger-btn",MOBILE_MENU_ID:"bottom-nav-mobile-menu"},zo=["toggle-filters","active-filters-badge","clear-all-btn","map-layer-selector","map-markers-selector","toggle-legend-btn","results-counter","unique-results-counter","toggle-results"];class To{constructor(e){this.elements=e,this.isOpen=!1,this.hamburgerBtn=null,this.mobileMenu=null,this.resizeHandler=null,this.clickHandler=null,this.init()}init(){this.createUI(),this.setupEventHandlers(),this.handleResize()}setupEventHandlers(){this.resizeHandler=this.debounce(()=>this.handleResize(),Ve.DEBOUNCE_DELAY),window.addEventListener("resize",this.resizeHandler)}createUI(){this.createHamburgerButton(),this.createMobileMenu()}createHamburgerButton(){const e=document.getElementById(Ve.HAMBURGER_ID);if(e){this.hamburgerBtn=e;return}this.hamburgerBtn=document.createElement("button"),this.hamburgerBtn.id=Ve.HAMBURGER_ID,this.hamburgerBtn.className="md:hidden p-2 z-60 text-gray-700 hover:text-gray-900",this.hamburgerBtn.setAttribute("aria-label","Apri menu"),this.hamburgerBtn.setAttribute("aria-expanded","false"),this.hamburgerBtn.innerHTML=`
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <line x1="5" y1="7" x2="19" y2="7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <line x1="5" y1="17" x2="19" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        `,this.clickHandler=()=>this.toggleMenu(),this.hamburgerBtn.addEventListener("click",this.clickHandler),(this.elements.bottomNav||document.querySelector("nav")||document.body).appendChild(this.hamburgerBtn)}createMobileMenu(){const e=document.getElementById(Ve.MOBILE_MENU_ID);if(e){this.mobileMenu=e;return}this.mobileMenu=document.createElement("div"),this.mobileMenu.id=Ve.MOBILE_MENU_ID,this.mobileMenu.className="md:hidden fixed bottom-14 left-4 right-4 bg-white shadow-lg p-3 rounded-lg flex-col gap-2 z-50",this.mobileMenu.setAttribute("data-open","false"),document.body.appendChild(this.mobileMenu)}toggleMenu(){this.isOpen=!this.isOpen,this.mobileMenu&&this.mobileMenu.setAttribute("data-open",this.isOpen?"true":"false"),this.hamburgerBtn&&this.hamburgerBtn.setAttribute("aria-expanded",this.isOpen?"true":"false")}handleResize(){window.innerWidth<Ve.MOBILE_BREAKPOINT?this.switchToMobile():this.switchToDesktop()}switchToMobile(){const e=this.elements.bottomNavContent;e&&(e.classList.remove("flex"),e.classList.add("hidden")),zo.forEach(t=>{const n=document.getElementById(t);n&&this.mobileMenu&&n.parentNode!==this.mobileMenu&&(n.classList.add("w-full","block"),this.mobileMenu.appendChild(n))}),this.closeMenu(),this.closePanels()}switchToDesktop(){const e=this.elements.bottomNavContent;e&&(e.classList.remove("hidden"),e.classList.add("flex")),this.mobileMenu&&Array.from(this.mobileMenu.childNodes).forEach(n=>{n instanceof HTMLElement&&e&&(n.classList.remove("w-full","block"),e.appendChild(n))}),this.closeMenu()}closeMenu(){this.isOpen=!1,this.mobileMenu&&this.mobileMenu.setAttribute("data-open","false"),this.hamburgerBtn&&this.hamburgerBtn.setAttribute("aria-expanded","false")}closePanels(){this.elements.filtersPanel&&this.elements.filtersPanel.setAttribute("data-open","false"),this.elements.resultsPanel&&this.elements.resultsPanel.setAttribute("data-open","false"),this.elements.toggleFilters&&this.elements.toggleFilters.setAttribute("data-active","false"),this.elements.toggleResults&&this.elements.toggleResults.setAttribute("data-active","false")}debounce(e,t){let n;return(...s)=>{clearTimeout(n),n=setTimeout(()=>e.apply(this,s),t)}}destroy(){this.resizeHandler&&window.removeEventListener("resize",this.resizeHandler),this.clickHandler&&this.hamburgerBtn&&this.hamburgerBtn.removeEventListener("click",this.clickHandler),this.hamburgerBtn&&this.hamburgerBtn.parentNode&&this.hamburgerBtn.remove(),this.mobileMenu&&this.mobileMenu.parentNode&&this.mobileMenu.remove(),this.hamburgerBtn=null,this.mobileMenu=null,this.resizeHandler=null,this.clickHandler=null}}const Re={zIndex:"9999",maxHeight:"max-h-96",contentMaxHeight:"max-h-64",defaultWidth:"w-72"},dr={close:`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
    </svg>`,check:`<svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
    </svg>`};class Mt{constructor(e,t){this.triggerId=e,this.popupId=t,this.trigger=null,this.isOpen=!1,this.cleanup=null}init(){return this.trigger=document.getElementById(this.triggerId),this.trigger?(this.trigger.style.cursor="pointer",this.trigger.onclick=e=>{e.stopPropagation(),this.toggle()},!0):(console.warn(`Trigger element ${this.triggerId} not found`),!1)}toggle(){this.isOpen?this.hide():this.show()}show(){if(this.isOpen)return;const e=this.createPopup();e&&(document.body.appendChild(e),this.isOpen=!0,this.bindEvents(e))}hide(){var t;const e=document.getElementById(this.popupId);e==null||e.remove(),(t=this.cleanup)==null||t.call(this),this.cleanup=null,this.isOpen=!1}bindEvents(e){const t=s=>{(s.key==="Escape"||s.type==="click"&&!e.contains(s.target)&&!this.trigger.contains(s.target))&&this.hide()};document.addEventListener("keydown",t),document.addEventListener("click",t);const n=e.querySelector(`#close-${this.popupId}`);n==null||n.addEventListener("click",()=>this.hide()),this.cleanup=()=>{document.removeEventListener("keydown",t),document.removeEventListener("click",t)}}createBasePopup(e){const t=document.createElement("div");t.id=this.popupId,t.className=`fixed p-2 ${Re.defaultWidth} max-w-sm bg-white rounded-lg shadow-2xl border border-gray-200 ${Re.maxHeight} overflow-hidden`,t.style.zIndex=Re.zIndex,hs.positionPopup(t,this.trigger);const n=document.createElement("div");return n.className="flex items-center justify-between mb-2",n.innerHTML=`
            <h3 class="p-2 text-sm font-semibold text-gray-800">${e}</h3>
            <button id="close-${this.popupId}" class="absolute top-2 right-2 p-1.5 bg-pink-100 hover:bg-pink-200 rounded-full text-red-500 shadow-md">
                ${dr.close}
            </button>
        `,t.appendChild(n),t}createPopup(){throw new Error("createPopup must be implemented by subclass")}destroy(){this.hide()}}class Bo extends Mt{constructor(e){super("active-filters-badge","active-filters-popup"),this.navBar=e}init(){const e=super.init();return e&&this.trigger&&(this.trigger.title="Clicca per vedere i filtri attivi"),e}createPopup(){const e=this.createBasePopup("Filtri Attivi"),t=document.createElement("div");t.className=`space-y-1 ${Re.contentMaxHeight} overflow-y-auto overflow-x-hidden`;const n=this.getSearchState(),i=new ds(this.navBar.config).render(n);return!i||i.trim()===""?t.innerHTML='<div class="p-3 text-sm text-gray-500 italic">Nessun filtro applicato</div>':t.innerHTML=i,e.appendChild(t),e}getSearchState(){var e;return(e=window.ledaSearch)!=null&&e.state?window.ledaSearch.state:{query:this.navBar.currentQuery||"",filters:this.navBar.currentFilters||{}}}}class $o extends Mt{constructor(e){super("toggle-legend-btn","map-legend-popup"),this.navBar=e}init(){const e=super.init();return e&&this.trigger&&(this.trigger.title="Clicca per leggere la legenda"),e}createPopup(){const e=this.createBasePopup("Legenda"),t=document.createElement("div");return t.className=`space-y-4 ${Re.contentMaxHeight} overflow-y-auto overflow-x-visible mb-3 p-3`,t.appendChild(this.createIntroSection()),t.appendChild(this.createPinSection()),t.appendChild(this.createFiltersSection()),t.appendChild(this.createReferencesSection()),t.appendChild(this.createPopupSection()),e.appendChild(t),e}getElement(e,t=""){const n=document.querySelector(e);if(!n)return document.createTextNode(t);const s=n.cloneNode(!0);return s.querySelectorAll("[id]").forEach(i=>i.removeAttribute("id")),s.hasAttribute("id")&&s.removeAttribute("id"),s}tooltip(e,t,n="top"){const s=document.createElement("span");s.className="relative inline-block group cursor-help";const i=document.createElement("span");i.className="text-blue-600 underline decoration-dotted underline-offset-2 hover:text-blue-800 transition-colors",i.textContent=e,s.appendChild(i);const o={top:"bottom-full left-1/2 -translate-x-1/2 mb-2",bottom:"top-full left-1/2 -translate-x-1/2 mt-2",left:"right-full top-1/2 -translate-y-1/2 mr-2",right:"left-full top-1/2 -translate-y-1/2 ml-2"},a={top:"top-full left-1/2 -translate-x-1/2 border-l-8 border-r-8 border-t-8 border-transparent border-t-gray-900",bottom:"bottom-full left-1/2 -translate-x-1/2 border-l-8 border-r-8 border-b-8 border-transparent border-b-gray-900",left:"left-full top-1/2 -translate-y-1/2 border-t-8 border-b-8 border-l-8 border-transparent border-l-gray-900",right:"right-full top-1/2 -translate-y-1/2 border-t-8 border-b-8 border-r-8 border-transparent border-r-gray-900"},c=document.createElement("div");c.className=`absolute ${o[n]} z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 delay-100`;const d=document.createElement("div");d.className="bg-gray-900 text-white text-sm rounded-lg py-2 px-3 max-w-xs shadow-xl whitespace-normal relative",d.appendChild(t.cloneNode(!0));const f=document.createElement("div");return f.className=`absolute w-0 h-0 ${a[n]}`,d.appendChild(f),c.appendChild(d),s.appendChild(c),s}createIntroSection(){const e=document.createElement("div");return e.className="space-y-2",e.innerHTML=`
            <p class="text-sm font-medium text-gray-800">Legenda della mappa</p>
            <p class="text-xs text-gray-600">Mostra i diversi elementi presenti sulla mappa.</p>
        `,e}createPinSection(){const e=document.createElement("div");e.className="border-t border-gray-200 pt-3 space-y-2";const t=document.createElement("p");return t.className="text-sm text-gray-700 leading-relaxed",t.textContent="I ",t.appendChild(this.tooltip("pin della mappa",this.getElement(".leaflet-marker-icon svg"),"top")),t.appendChild(document.createTextNode(" indicano i luoghi presenti sulla mappa.")),e.appendChild(t),e}createFiltersSection(){const e=document.createElement("div");e.className="border-t border-gray-200 pt-3 space-y-2";const t=document.createElement("p");return t.className="text-sm text-gray-700 leading-relaxed",t.appendChild(document.createTextNode("I ")),t.appendChild(this.tooltip("filtri",this.getElement("#toggle-filters"),"right")),t.appendChild(document.createTextNode(" intervengono sul filtraggio sia dei luoghi sulla mappa sia dei riferimenti ad essi associati. Il numero di occorrenze dei filtri rappresenta il numero di volte in cui ciascun luogo  stato menzionato. ")),e.appendChild(t),e}createReferencesSection(){const e=document.createElement("div");e.className="border-t border-gray-200 pt-3 space-y-2";const t=document.createElement("p");return t.className="text-sm text-gray-700 leading-relaxed",t.appendChild(document.createTextNode("La sezione ")),t.appendChild(this.tooltip("riferimenti",this.getElement("#toggle-results"),"top")),t.appendChild(document.createTextNode(" mostra tutti i riferimenti ai luoghi presenti nella mappa.")),e.appendChild(t),e}createPopupSection(){const e=document.createElement("div");e.className="border-t border-gray-200 pt-3";const t=document.createElement("p");return t.className="text-sm text-gray-700 leading-relaxed",t.appendChild(document.createTextNode("Ogni pin sulla mappa apre un ")),t.appendChild(this.tooltip("popup informativo",this.getElement(".bg-gradient-to-r"),"top")),t.appendChild(document.createTextNode(" con dettagli specifici del luogo.")),e.appendChild(t),e}}class Do extends Mt{constructor(e){super("map-layer-selector","layer-selection-popup"),this.layers=e,this.currentLayerName="Default",this.currentTileLayer=null}init(){const e=super.init();return e&&this.trigger&&(this.trigger.title="Clicca per cambiare layer"),e}createPopup(){const e=this.createBasePopup("Seleziona uno strato cartografico"),t=document.createElement("div");return t.className=`space-y-1 ${Re.contentMaxHeight} overflow-y-auto overflow-x-hidden mb-3 p-3`,t.innerHTML=this.buildLayersHTML(),t.querySelectorAll(".layer-item").forEach(n=>{n.addEventListener("click",()=>{const{layerName:s,layerUrl:i,layerAttribution:o}=n.dataset;this.selectLayer(s,i,o),this.hide()})}),e.appendChild(t),e}buildLayersHTML(){return Object.entries(this.layers).map(([e,t])=>`
            <div class="layer-item flex items-center justify-between p-2 rounded hover:bg-gray-100 cursor-pointer" 
                data-layer-name="${e}" 
                data-layer-url="${t.tileLayer}"
                data-layer-attribution="${t.attribution}">
                <span class="text-sm text-gray-700">${e}</span>
                ${e===this.currentLayerName?dr.check:""}
            </div>
        `).join("")}selectLayer(e,t,n){this.currentTileLayer&&window.map&&window.map.removeLayer(this.currentTileLayer),window.L&&window.map&&(this.currentTileLayer=window.L.tileLayer(t,{attribution:n,maxZoom:18}),this.currentTileLayer.addTo(window.map)),this.currentLayerName=e,document.dispatchEvent(new CustomEvent("layerChanged",{detail:{layerName:e,layerUrl:t,attribution:n}}))}}class Uo extends Mt{constructor(e){super("map-markers-selector","markers-selection-popup"),this.mapInstance=e,this.currentMarkerType="clusters",this.markerTypes={clusters:{name:"Clusters geografici",description:"Raggruppamenti dinamici dei luoghi",icon:this.getClusterIcon()},pins:{name:"Pin con numeri",description:"Pin con numero dei riferimenti",icon:this.getPinIcon()},circles:{name:"Cerchi Proporzionali",description:"Cerchi con diametro basato sui riferimenti",icon:this.getCircleIcon()}}}init(){const e=super.init();return e&&this.trigger&&(this.trigger.title="Clicca per cambiare tipo di marcatore"),e}createPopup(){const e=this.createBasePopup("Seleziona un tipo di marcatore"),t=document.createElement("div");return t.className=`space-y-1 ${Re.contentMaxHeight} overflow-y-auto overflow-x-hidden`,t.innerHTML=this.buildMarkersHTML(),t.querySelectorAll(".marker-item").forEach(n=>{n.addEventListener("click",()=>{this.selectMarkerType(n.dataset.markerType),this.hide()})}),e.appendChild(t),e}buildMarkersHTML(){return Object.entries(this.markerTypes).map(([e,t])=>`
            <div class="marker-item flex items-center justify-between p-2 rounded hover:bg-gray-50 hover:shadow-md cursor-pointer" 
                 data-marker-type="${e}">
                <div class="flex items-center space-x-3">
                    ${t.icon}
                    <div>
                        <span class="text-sm font-medium text-gray-700">${t.name}</span>
                        <p class="text-xs text-gray-500">${t.description}</p>
                    </div>
                </div>
                ${e===this.currentMarkerType?dr.check:""}
            </div>
        `).join("")}selectMarkerType(e){var n;this.currentMarkerType=e;const t=window.switchMarkerType||((n=this.mapInstance)==null?void 0:n.switchMarkerType);t&&(typeof t=="function"?t(e):t.call(this.mapInstance,e)),document.dispatchEvent(new CustomEvent("markerTypeChanged",{detail:{markerType:e,markerName:this.markerTypes[e].name}}))}getClusterIcon(){return`<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 32 32">
            <path d="M27 21.75c-0.795 0.004-1.538 0.229-2.169 0.616l0.018-0.010-2.694-2.449c0.724-1.105 1.154-2.459 1.154-3.913 0-1.572-0.503-3.027-1.358-4.212l0.015 0.021 3.062-3.062c0.57 0.316 1.249 0.503 1.971 0.508h0.002c2.347 0 4.25-1.903 4.25-4.25s-1.903-4.25-4.25-4.25c-2.347 0-4.25 1.903-4.25 4.25v0c0.005 0.724 0.193 1.403 0.519 1.995l-0.011-0.022-3.062 3.062c-1.147-0.84-2.587-1.344-4.144-1.344-0.868 0-1.699 0.157-2.467 0.443l0.049-0.016-0.644-1.17c0.726-0.757 1.173-1.787 1.173-2.921 0-2.332-1.891-4.223-4.223-4.223s-4.223 1.891-4.223 4.223c0 2.332 1.891 4.223 4.223 4.223 0.306 0 0.605-0.033 0.893-0.095l-0.028 0.005 0.642 1.166c-1.685 1.315-2.758 3.345-2.758 5.627 0 0.605 0.076 1.193 0.218 1.754l-0.011-0.049-0.667 0.283c-0.78-0.904-1.927-1.474-3.207-1.474-2.334 0-4.226 1.892-4.226 4.226s1.892 4.226 4.226 4.226c2.334 0 4.226-1.892 4.226-4.226 0-0.008-0-0.017-0-0.025v0.001c-0.008-0.159-0.023-0.307-0.046-0.451l0.003 0.024 0.667-0.283c1.303 2.026 3.547 3.349 6.1 3.349 1.703 0 3.268-0.589 4.503-1.574l-0.015 0.011 2.702 2.455c-0.258 0.526-0.41 1.144-0.414 1.797v0.001c0 2.347 1.903 4.25 4.25 4.25s4.25-1.903 4.25-4.25c0-2.347-1.903-4.25-4.25-4.25v0z"></path>
        </svg>`}getPinIcon(){return`<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
        </svg>`}getCircleIcon(){return`<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm0-2a6 6 0 100-12 6 6 0 000 12z" clip-rule="evenodd"></path>
        </svg>`}}const Vo={filtersPanel:"filters-panel",resultsPanel:"results-panel",toggleFilters:"toggle-filters",toggleResults:"toggle-results",activeFiltersBadge:"active-filters-badge",activeFiltersCount:"active-filters-count",mentionsCounter:"mentions-counter",mentionsCount:"mentions-count",resultsCounter:"results-counter",resultsCount:"results-count",uniqueResultsCounter:"unique-results-counter",uniqueResultsCount:"unique-results-count",clearAllBtn:"clear-all-btn",layerButton:"map-layer-selector",markersButton:"map-markers-selector",bottomNav:"bottom-nav",bottomNavContent:"bottom-nav-content",toggleLegendBtn:"toggle-legend-btn"};class Ho{constructor(){this.state=new Ro,this.elements={},this.popups={},this.mobileMenu=null,this.cleanupFns=[],this.init()}get config(){var e;return(e=window.ledaSearch)==null?void 0:e.config}get mapInstance(){var e;return(e=window.ledaSearch)==null?void 0:e.mapInstance}get currentFilters(){var t,n,s,i,o;const e=((n=(t=window.ledaSearch)==null?void 0:t.stateManager)==null?void 0:n.state)||((o=(i=(s=window.ledaSearch)==null?void 0:s.filterManager)==null?void 0:i.stateManager)==null?void 0:o.state);return(e==null?void 0:e.filters)||{}}get currentQuery(){var t,n,s,i,o;const e=((n=(t=window.ledaSearch)==null?void 0:t.stateManager)==null?void 0:n.state)||((o=(i=(s=window.ledaSearch)==null?void 0:s.filterManager)==null?void 0:i.stateManager)==null?void 0:o.state);return(e==null?void 0:e.query)||""}init(){try{this.initElements(),this.initState(),this.bindEvents(),this.initPopups(),this.initMobileMenu(),this.initTooltip()}catch(e){console.error("NavBarRenderer: Initialization error",e)}}initElements(){this.elements=Object.fromEntries(Object.entries(Vo).map(([e,t])=>[e,document.getElementById(t)]))}initState(){var t,n,s,i,o,a;const e=this.state.subscribe(c=>this.onStateChange(c));this.cleanupFns.push(e),(t=this.elements.filtersPanel)==null||t.setAttribute("data-open","true"),(n=this.elements.resultsPanel)==null||n.setAttribute("data-open","true"),(s=this.elements.toggleFilters)==null||s.setAttribute("data-active","true"),(i=this.elements.toggleResults)==null||i.setAttribute("data-active","true"),this.state.activeFiltersCount===0&&((o=this.elements.activeFiltersBadge)==null||o.classList.add("hidden"),(a=this.elements.clearAllBtn)==null||a.classList.add("hidden"))}onStateChange(e){"activeFiltersCount"in e&&this.updateFiltersUI(e.activeFiltersCount.new),("resultsCount"in e||"uniqueResultsCount"in e||"mentionsCount"in e)&&this.updateResultsUI(this.state.mentionsCount||0,this.state.uniqueResultsCount||0,this.state.resultsCount||0),"isFiltersOpen"in e&&this.updatePanelUI("filters",e.isFiltersOpen.new),"isResultsOpen"in e&&this.updatePanelUI("results",e.isResultsOpen.new),this.emitStateChanges(e)}updateFiltersUI(e){var t,n,s,i,o,a;this.elements.activeFiltersCount&&(this.elements.activeFiltersCount.textContent=e),e>0?((t=this.elements.activeFiltersBadge)==null||t.classList.remove("hidden"),(n=this.elements.clearAllBtn)==null||n.classList.remove("hidden")):((s=this.elements.activeFiltersBadge)==null||s.classList.add("hidden"),(i=this.elements.clearAllBtn)==null||i.classList.add("hidden")),(o=this.elements.activeFiltersBadge)==null||o.setAttribute("data-visible",e>0),(a=this.elements.clearAllBtn)==null||a.setAttribute("data-visible",e>0)}updateResultsUI(e,t,n){this.elements.mentionsCount&&(this.elements.mentionsCount.textContent=e),this.elements.mentionsCounter&&(this.elements.mentionsCounter.style.display=e>0?"":"none"),this.elements.resultsCount&&(this.elements.resultsCount.textContent=n),this.elements.resultsCounter&&(this.elements.resultsCounter.style.display=n>0?"":"none"),this.elements.uniqueResultsCount&&(this.elements.uniqueResultsCount.textContent=t),this.elements.uniqueResultsCounter&&(this.elements.uniqueResultsCounter.style.display=t>0?"":"none")}updatePanelUI(e,t){var s,i;const n=this.getPanelConfig(e);n&&((s=n.panel)==null||s.setAttribute("data-open",t),(i=n.button)==null||i.setAttribute("data-active",t))}emitStateChanges(e){Object.entries(e).forEach(([t,n])=>{const i={activeFiltersCount:"activeFiltersChanged",resultsCount:"resultsCountChanged",isFiltersOpen:"panelToggled",isResultsOpen:"panelToggled"}[t];i&&document.dispatchEvent(new CustomEvent(`navbar:${i}`,{detail:{type:t.replace("is","").replace("Open","").toLowerCase(),...n}}))})}bindEvents(){this.bindElement(this.elements.toggleFilters,()=>this.togglePanel("filters")),this.bindElement(this.elements.toggleResults,()=>this.togglePanel("results")),this.bindElement(this.elements.clearAllBtn,()=>this.clearAllFilters())}bindElement(e,t){e&&(e.addEventListener("click",t),this.cleanupFns.push(()=>e.removeEventListener("click",t)))}initPopups(){fs.waitForGlobal("ledaSearch",()=>{var e,t;this.popups.activeFilters=new Bo(this),this.popups.activeFilters.init(),(t=(e=this.config)==null?void 0:e.map)!=null&&t.tileLayers&&(this.popups.layers=new Do(this.config.map.tileLayers),this.popups.layers.init()),this.mapInstance&&(this.popups.markers=new Uo(this.mapInstance),this.popups.markers.init(),setTimeout(()=>{this.popups.legend=new $o(this),this.popups.legend.init()},5e3))})}initMobileMenu(){this.mobileMenu=new To(this.elements),this.cleanupFns.push(()=>{var e;return(e=this.mobileMenu)==null?void 0:e.destroy()})}updateFromSearchState(e,t=[],n={}){var o;if(!e)return;let s=ps.calculateActiveFiltersCount(e.filters);(o=e.query)!=null&&o.trim()&&(s+=1);const i=this.calculateUniqueCounts(t);this.state.update({activeFiltersCount:s,mentionsCount:i.totalMentions,resultsCount:i.uniqueLocations,uniqueResultsCount:i.uniquePivotIds})}calculateUniqueCounts(e){if(!Array.isArray(e)||e.length===0)return{uniquePivotIds:0,uniqueLocations:0,totalMentions:0};const t=new Set,n=new Set;return e.forEach(s=>{s.pivot_ID&&t.add(s.pivot_ID),s.Location&&n.add(s.Location)}),console.log(" CONTEGGI:",{totalMentions:e.length,uniquePivotIds:t.size,uniqueLocations:n.size,pivot_IDs:Array.from(t),Locations:Array.from(n)}),{uniquePivotIds:t.size,uniqueLocations:n.size,totalMentions:e.length}}updateFilters(e){this.state.update({activeFiltersCount:e})}initTooltip(){const e=this.elements.resultsCounter;if(!e)return;const t=document.createElement("div");t.id="results-counter-tooltip",t.className="fixed px-4 py-3 bg-gray-900 text-white text-xs rounded-lg shadow-xl whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-200",t.style.zIndex="99999",t.innerHTML=`
            <div class="space-y-1">
                <div><strong class="text-yellow-300">Menzioni:</strong> Numero di menzioni di luoghi nelle fonti</div>
                <div><strong class="text-green-300">Luoghi:</strong> Numero di luoghi unici menzionati dalle fonti</div>
                <div><strong class="text-blue-300">Riferimenti:</strong> Numero di fonti che menzionano i luoghi</div>
            </div>
            <div class="absolute top-full left-1/2 transform -translate-x-1/2 -mt-1">
                <div class="border-4 border-transparent border-t-gray-900"></div>
            </div>
        `,document.body.appendChild(t);const n=()=>{const s=e.getBoundingClientRect();t.style.left=`${s.left+s.width/2}px`,t.style.top=`${s.top-10}px`,t.style.transform="translate(-50%, -100%)"};e.addEventListener("mouseenter",()=>{n(),t.style.opacity="1"}),e.addEventListener("mouseleave",()=>{t.style.opacity="0"}),window.addEventListener("scroll",n),window.addEventListener("resize",n),this.cleanupFns.push(()=>{t.remove(),window.removeEventListener("scroll",n),window.removeEventListener("resize",n)})}updateResults(e,t=0){this.state.update({resultsCount:e,uniqueResultsCount:t})}togglePanel(e){const t=`is${e.charAt(0).toUpperCase()+e.slice(1)}Open`;this.state.update({[t]:!this.state[t]})}getPanelConfig(e){return{filters:{panel:this.elements.filtersPanel,button:this.elements.toggleFilters},results:{panel:this.elements.resultsPanel,button:this.elements.toggleResults}}[e]}closeAllPanels(){this.state.update({isFiltersOpen:!1,isResultsOpen:!1})}clearAllFilters(){Object.values(this.popups).forEach(e=>e==null?void 0:e.hide()),this.state.update({activeFiltersCount:0,resultsCount:0,uniqueResultsCount:0}),document.dispatchEvent(new CustomEvent("navbar:clearAllFilters",{detail:{resetInterface:!0,clearSearch:!0,clearFacets:!0,clearMap:!0}})),setTimeout(()=>{ut.resetFacetsInterface(),ut.clearSearchInput()},100),Sr.show("Tutti i filtri sono stati rimossi","success",2e3)}getState(){return{...this.state.getSnapshot(),currentFilters:this.currentFilters,currentQuery:this.currentQuery,config:this.config,mapInstance:this.mapInstance}}setState(e){const t={};Object.entries(e).forEach(([n,s])=>{this.state.hasOwnProperty(n)?t[n]=s:["currentFilters","currentQuery","config","mapInstance"].includes(n)&&console.warn(`NavBarRenderer: ${n}  read-only`)}),Object.keys(t).length>0&&this.state.update(t)}addEventListener(e,t){document.addEventListener(`navbar:${e}`,t)}removeEventListener(e,t){document.removeEventListener(`navbar:${e}`,t)}showNotification(e,t="info",n=3e3){Sr.show(e,t,n)}resetInterface(){this.state.reset(),Object.values(this.popups).forEach(e=>e==null?void 0:e.hide()),ut.resetFacetsInterface(),ut.clearSearchInput()}destroy(){this.cleanupFns.forEach(e=>e()),Object.values(this.popups).forEach(e=>e==null?void 0:e.destroy()),this.cleanupFns=[],this.elements={},this.popups={},this.mobileMenu=null}}const qo=new Ho;class Un{constructor(){this.originalFacetData=new Map}renderTaxonomy(e,t,n,s){const o=(s.filters||{})[n]||[];this.originalFacetData.has(n)||this.originalFacetData.set(n,JSON.parse(JSON.stringify(t)));const a=o.length>0?this.originalFacetData.get(n):t,c=this._buildHierarchy(a);this._calculateTotalCounts(c),e.className="taxonomy-container max-w-full overflow-x-auto max-h-80 overflow-y-auto",e.innerHTML=this._createTaxonomyHTML(c,[],0,n,o),this._setCheckboxStates(e,c,o),this._addEventListeners(e,c,n)}resetOriginalData(e=null){e?this.originalFacetData.delete(e):this.originalFacetData.clear()}_buildHierarchy(e){const t={};return Array.isArray(e)&&e.forEach(n=>{const s=n.key.split(" > ");let i=t;s.forEach((o,a)=>{i[o]||(i[o]={children:{},docCount:0,selfCount:0}),a===s.length-1&&(i[o].selfCount=n.doc_count),i=i[o].children})}),t}_calculateTotalCounts(e){const t=n=>{let s=n.selfCount||0;return Object.values(n.children||{}).forEach(i=>{s+=t(i)}),n.docCount=s,s};Object.values(e).forEach(t)}_setCheckboxStates(e,t,n){const s=(i,o=[])=>{Object.entries(i).forEach(([a,c])=>{if(this._isMetadataKey(a))return;const d=[...o,a].join(" > "),f=e.querySelector(`input[value="${d}"]`);if(!f)return;f.checked=n.includes(d);const m=this._getAllChildPaths(c.children||{},[...o,a]).some(h=>n.includes(h));f.indeterminate=m&&!f.checked,s(c.children,[...o,a])})};s(t)}_createTaxonomyHTML(e,t=[],n=0,s,i){let o='<div class="space-y-1">';return Object.entries(e).forEach(([a,c])=>{if(this._isMetadataKey(a))return;const d=[...t,a],f=d.join(" > "),w=Object.keys(c.children).length>0,m=i.includes(f),h=w&&this._hasSelectedChild(c.children,i,d),y=m||h,x=c.docCount===0;o+=`
        <div class="taxonomy-item">
          <label class="block facet-option ${x?"text-gray-400 cursor-not-allowed opacity-50":"cursor-pointer"}" data-search-text="${a.toLowerCase()}">
            <div></div>
            ${this._createToggleButton(w,f,y)}
            <div class="flex items-center gap-2 min-w-0">
              <input type="checkbox" value="${f}" data-facet-type="${s}" class="form-checkbox flex-shrink-0" ${m?"checked":""} ${x?"disabled":""}>
              <span class="text-sm">${a}</span>
            </div>
            <span class="text-xs px-2 py-0.5 rounded-full flex-shrink-0 ${x?"text-gray-400 bg-gray-100":"text-secondary-500 bg-secondary-100"}">${c.docCount}</span>
          </label>
          ${this._createChildrenContainer(w,f,y,c.children,d,n+1,s,i)}
        </div>`}),o+"</div>"}_createToggleButton(e,t,n){return e?`<button class="toggle-btn flex-shrink-0 w-5 h-5 flex items-center justify-center rounded hover:bg-gray-200 transition-colors" data-path="${t}">
        <svg class="w-3 h-3 text-gray-600 transform transition-transform duration-200 ${n?"rotate-90":""}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </button>`:'<div class="w-5 h-5 flex-shrink-0"></div>'}_createChildrenContainer(e,t,n,s,i,o,a,c){return e?`<div class="children ${n?"":"hidden"}" data-parent="${t}">
        ${this._createTaxonomyHTML(s,i,o,a,c)}
      </div>`:""}_isMetadataKey(e){return["children","docCount","selfCount"].includes(e)}_hasSelectedChild(e,t,n=[]){for(const[s,i]of Object.entries(e)){if(this._isMetadataKey(s))continue;const o=[...n,s].join(" > ");if(t.includes(o)||Object.keys(i.children).length>0&&this._hasSelectedChild(i.children,t,[...n,s]))return!0}return!1}_getParentPaths(e){const t=e.split(" > "),n=[];for(let s=1;s<t.length;s++)n.push(t.slice(0,s).join(" > "));return n}_getAllChildPaths(e,t=[]){const n=[];return Object.entries(e).forEach(([s,i])=>{if(this._isMetadataKey(s))return;const o=[...t,s].join(" > ");n.push(o),Object.keys(i.children).length>0&&n.push(...this._getAllChildPaths(i.children,[...t,s]))}),n}_getChildPathsForNode(e,t){const n=t.split(" > ");let s=e;for(const i of n)if(s[i])s=s[i];else return[];return this._getAllChildPaths(s.children,n)}_addEventListeners(e,t,n){e._hierarchy=t,this._addToggleListeners(e),this._addCheckboxListeners(e,t,n)}_addToggleListeners(e){e.addEventListener("click",t=>{const n=t.target.closest(".toggle-btn");if(!n)return;const s=n.dataset.path,i=e.querySelector(`[data-parent="${s}"]`),o=n.querySelector("svg");if(i&&o){const a=i.classList.contains("hidden");i.classList.toggle("hidden"),o.classList.toggle("rotate-90",a)}})}_addCheckboxListeners(e,t,n){e.addEventListener("change",s=>{if(s.target.type!=="checkbox")return;const i=s.target;if(i.disabled){s.preventDefault();return}const o=i.value,a=i.checked;s.stopPropagation();const c=this._getParentPaths(o),d=this._getChildPathsForNode(t,o);this._updateRelatedCheckboxes(e,t,o,a,c,d),e.dispatchEvent(new CustomEvent("taxonomyChange",{detail:{facetKey:n,path:o,checked:a,action:a?"add":"remove"}}))})}_updateRelatedCheckboxes(e,t,n,s,i,o){s?(this._updateCheckboxes(e,i,!0),this._updateCheckboxes(e,o,!0)):(this._updateCheckboxes(e,o,!1),this._updateParentCheckboxes(e,t,i)),this._updateCheckboxVisuals(e.querySelector(`input[value="${n}"]`),s)}_updateCheckboxes(e,t,n){t==null||t.forEach(s=>{const i=e.querySelector(`input[value="${s}"]`);i&&i.checked!==n&&!i.disabled&&(i.checked=n,this._updateCheckboxVisuals(i,n))})}_updateParentCheckboxes(e,t,n){n==null||n.forEach(s=>{const i=e.querySelector(`input[value="${s}"]`);if(!(i!=null&&i.checked)||i.disabled)return;this._getChildPathsForNode(t,s).some(c=>{const d=e.querySelector(`input[value="${c}"]`);return d==null?void 0:d.checked})||(i.checked=!1,this._updateCheckboxVisuals(i,!1))})}_updateCheckboxVisuals(e,t){var s;if(!e)return;const n=(s=e.closest("label"))==null?void 0:s.querySelector("span.text-sm");n&&(n.classList.toggle("font-medium",t),n.classList.toggle("text-primary-700",t))}_renderTaxonomyFacet(e,t,n,s,i,o,a){const c=document.createElement("div"),d=s[t]||[];this.renderTaxonomy(c,d,t,o),c.addEventListener("taxonomyChange",f=>{const{facetKey:w,path:m,checked:h}=f.detail;a({type:"FACET_CHANGE",facetType:w,value:m,checked:h})}),e.appendChild(c)}}var je;(function(r){r.Range="range",r.Steps="steps",r.Positions="positions",r.Count="count",r.Values="values"})(je||(je={}));var oe;(function(r){r[r.None=-1]="None",r[r.NoValue=0]="NoValue",r[r.LargeValue=1]="LargeValue",r[r.SmallValue=2]="SmallValue"})(oe||(oe={}));function Wo(r){return _t(r)&&typeof r.from=="function"}function _t(r){return typeof r=="object"&&typeof r.to=="function"}function hn(r){r.parentElement.removeChild(r)}function er(r){return r!=null}function fn(r){r.preventDefault()}function Go(r){return r.filter(function(e){return this[e]?!1:this[e]=!0},{})}function Jo(r,e){return Math.round(r/e)*e}function Qo(r,e){var t=r.getBoundingClientRect(),n=r.ownerDocument,s=n.documentElement,i=Vn(n);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(i.x=0),e?t.top+i.y-s.clientTop:t.left+i.x-s.clientLeft}function ve(r){return typeof r=="number"&&!isNaN(r)&&isFinite(r)}function pn(r,e,t){t>0&&(se(r,e),setTimeout(function(){wt(r,e)},t))}function gn(r){return Math.max(Math.min(r,100),0)}function kt(r){return Array.isArray(r)?r:[r]}function Xo(r){r=String(r);var e=r.split(".");return e.length>1?e[1].length:0}function se(r,e){r.classList&&!/\s/.test(e)?r.classList.add(e):r.className+=" "+e}function wt(r,e){r.classList&&!/\s/.test(e)?r.classList.remove(e):r.className=r.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function Yo(r,e){return r.classList?r.classList.contains(e):new RegExp("\\b"+e+"\\b").test(r.className)}function Vn(r){var e=window.pageXOffset!==void 0,t=(r.compatMode||"")==="CSS1Compat",n=e?window.pageXOffset:t?r.documentElement.scrollLeft:r.body.scrollLeft,s=e?window.pageYOffset:t?r.documentElement.scrollTop:r.body.scrollTop;return{x:n,y:s}}function Zo(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function Ko(){var r=!1;try{var e=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("test",null,e)}catch{}return r}function ea(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function hr(r,e){return 100/(e-r)}function tr(r,e,t){return e*100/(r[t+1]-r[t])}function ta(r,e){return tr(r,r[0]<0?e+Math.abs(r[0]):e-r[0],0)}function ra(r,e){return e*(r[1]-r[0])/100+r[0]}function st(r,e){for(var t=1;r>=e[t];)t+=1;return t}function na(r,e,t){if(t>=r.slice(-1)[0])return 100;var n=st(t,r),s=r[n-1],i=r[n],o=e[n-1],a=e[n];return o+ta([s,i],t)/hr(o,a)}function sa(r,e,t){if(t>=100)return r.slice(-1)[0];var n=st(t,e),s=r[n-1],i=r[n],o=e[n-1],a=e[n];return ra([s,i],(t-o)*hr(o,a))}function ia(r,e,t,n){if(n===100)return n;var s=st(n,r),i=r[s-1],o=r[s];return t?n-i>(o-i)/2?o:i:e[s-1]?r[s-1]+Jo(n-r[s-1],e[s-1]):n}var Hn=function(){function r(e,t,n){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[n||!1],this.xNumSteps=[!1],this.snap=t;var s,i=[];for(Object.keys(e).forEach(function(o){i.push([kt(e[o]),o])}),i.sort(function(o,a){return o[0][0]-a[0][0]}),s=0;s<i.length;s++)this.handleEntryPoint(i[s][1],i[s][0]);for(this.xNumSteps=this.xSteps.slice(0),s=0;s<this.xNumSteps.length;s++)this.handleStepPoint(s,this.xNumSteps[s])}return r.prototype.getDistance=function(e){for(var t=[],n=0;n<this.xNumSteps.length-1;n++)t[n]=tr(this.xVal,e,n);return t},r.prototype.getAbsoluteDistance=function(e,t,n){var s=0;if(e<this.xPct[this.xPct.length-1])for(;e>this.xPct[s+1];)s++;else e===this.xPct[this.xPct.length-1]&&(s=this.xPct.length-2);!n&&e===this.xPct[s+1]&&s++,t===null&&(t=[]);var i,o=1,a=t[s],c=0,d=0,f=0,w=0;for(n?i=(e-this.xPct[s])/(this.xPct[s+1]-this.xPct[s]):i=(this.xPct[s+1]-e)/(this.xPct[s+1]-this.xPct[s]);a>0;)c=this.xPct[s+1+w]-this.xPct[s+w],t[s+w]*o+100-i*100>100?(d=c*i,o=(a-100*i)/t[s+w],i=1):(d=t[s+w]*c/100*o,o=0),n?(f=f-d,this.xPct.length+w>=1&&w--):(f=f+d,this.xPct.length-w>=1&&w++),a=t[s+w]*o;return e+f},r.prototype.toStepping=function(e){return e=na(this.xVal,this.xPct,e),e},r.prototype.fromStepping=function(e){return sa(this.xVal,this.xPct,e)},r.prototype.getStep=function(e){return e=ia(this.xPct,this.xSteps,this.snap,e),e},r.prototype.getDefaultStep=function(e,t,n){var s=st(e,this.xPct);return(e===100||t&&e===this.xPct[s-1])&&(s=Math.max(s-1,1)),(this.xVal[s]-this.xVal[s-1])/n},r.prototype.getNearbySteps=function(e){var t=st(e,this.xPct);return{stepBefore:{startValue:this.xVal[t-2],step:this.xNumSteps[t-2],highestStep:this.xHighestCompleteStep[t-2]},thisStep:{startValue:this.xVal[t-1],step:this.xNumSteps[t-1],highestStep:this.xHighestCompleteStep[t-1]},stepAfter:{startValue:this.xVal[t],step:this.xNumSteps[t],highestStep:this.xHighestCompleteStep[t]}}},r.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(Xo);return Math.max.apply(null,e)},r.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},r.prototype.convert=function(e){return this.getStep(this.toStepping(e))},r.prototype.handleEntryPoint=function(e,t){var n;if(e==="min"?n=0:e==="max"?n=100:n=parseFloat(e),!ve(n)||!ve(t[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(n),this.xVal.push(t[0]);var s=Number(t[1]);n?this.xSteps.push(isNaN(s)?!1:s):isNaN(s)||(this.xSteps[0]=s),this.xHighestCompleteStep.push(0)},r.prototype.handleStepPoint=function(e,t){if(t){if(this.xVal[e]===this.xVal[e+1]){this.xSteps[e]=this.xHighestCompleteStep[e]=this.xVal[e];return}this.xSteps[e]=tr([this.xVal[e],this.xVal[e+1]],t,0)/hr(this.xPct[e],this.xPct[e+1]);var n=(this.xVal[e+1]-this.xVal[e])/this.xNumSteps[e],s=Math.ceil(Number(n.toFixed(3))-1),i=this.xVal[e]+this.xNumSteps[e]*s;this.xHighestCompleteStep[e]=i}},r}(),mn={to:function(r){return r===void 0?"":r.toFixed(2)},from:Number},qn={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},Oe={tooltips:".__tooltips",aria:".__aria"};function oa(r,e){if(!ve(e))throw new Error("noUiSlider: 'step' is not numeric.");r.singleStep=e}function aa(r,e){if(!ve(e))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");r.keyboardPageMultiplier=e}function la(r,e){if(!ve(e))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");r.keyboardMultiplier=e}function ca(r,e){if(!ve(e))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");r.keyboardDefaultStep=e}function ua(r,e){if(typeof e!="object"||Array.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(e.min===void 0||e.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");r.spectrum=new Hn(e,r.snap||!1,r.singleStep)}function da(r,e){if(e=kt(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider: 'start' option is incorrect.");r.handles=e.length,r.start=e}function ha(r,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");r.snap=e}function fa(r,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");r.animate=e}function pa(r,e){if(typeof e!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");r.animationDuration=e}function Wn(r,e){var t=[!1],n;if(e==="lower"?e=[!0,!1]:e==="upper"&&(e=[!1,!0]),e===!0||e===!1){for(n=1;n<r.handles;n++)t.push(e);t.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==r.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");t=e}r.connect=t}function ga(r,e){switch(e){case"horizontal":r.ort=0;break;case"vertical":r.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function Gn(r,e){if(!ve(e))throw new Error("noUiSlider: 'margin' option must be numeric.");e!==0&&(r.margin=r.spectrum.getDistance(e))}function ma(r,e){if(!ve(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(r.limit=r.spectrum.getDistance(e),!r.limit||r.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function va(r,e){var t;if(!ve(e)&&!Array.isArray(e))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&!(e.length===2||ve(e[0])||ve(e[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(e!==0){for(Array.isArray(e)||(e=[e,e]),r.padding=[r.spectrum.getDistance(e[0]),r.spectrum.getDistance(e[1])],t=0;t<r.spectrum.xNumSteps.length-1;t++)if(r.padding[0][t]<0||r.padding[1][t]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var n=e[0]+e[1],s=r.spectrum.xVal[0],i=r.spectrum.xVal[r.spectrum.xVal.length-1];if(n/(i-s)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function wa(r,e){switch(e){case"ltr":r.dir=0;break;case"rtl":r.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function ya(r,e){if(typeof e!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var t=e.indexOf("tap")>=0,n=e.indexOf("drag")>=0,s=e.indexOf("fixed")>=0,i=e.indexOf("snap")>=0,o=e.indexOf("hover")>=0,a=e.indexOf("unconstrained")>=0,c=e.indexOf("invert-connects")>=0,d=e.indexOf("drag-all")>=0,f=e.indexOf("smooth-steps")>=0;if(s){if(r.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");Gn(r,r.start[1]-r.start[0])}if(c&&r.handles!==2)throw new Error("noUiSlider: 'invert-connects' behaviour must be used with 2 handles");if(a&&(r.margin||r.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");r.events={tap:t||i,drag:n,dragAll:d,smoothSteps:f,fixed:s,snap:i,hover:o,unconstrained:a,invertConnects:c}}function ba(r,e){if(e!==!1)if(e===!0||_t(e)){r.tooltips=[];for(var t=0;t<r.handles;t++)r.tooltips.push(e)}else{if(e=kt(e),e.length!==r.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.forEach(function(n){if(typeof n!="boolean"&&!_t(n))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),r.tooltips=e}}function xa(r,e){if(e.length!==r.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");r.handleAttributes=e}function _a(r,e){if(!_t(e))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");r.ariaFormat=e}function Sa(r,e){if(!Wo(e))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");r.format=e}function Ca(r,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");r.keyboardSupport=e}function Ea(r,e){r.documentElement=e}function Ma(r,e){if(typeof e!="string"&&e!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");r.cssPrefix=e}function ka(r,e){if(typeof e!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof r.cssPrefix=="string"?(r.cssClasses={},Object.keys(e).forEach(function(t){r.cssClasses[t]=r.cssPrefix+e[t]})):r.cssClasses=e}function Jn(r){var e={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:mn,format:mn},t={step:{r:!1,t:oa},keyboardPageMultiplier:{r:!1,t:aa},keyboardMultiplier:{r:!1,t:la},keyboardDefaultStep:{r:!1,t:ca},start:{r:!0,t:da},connect:{r:!0,t:Wn},direction:{r:!0,t:wa},snap:{r:!1,t:ha},animate:{r:!1,t:fa},animationDuration:{r:!1,t:pa},range:{r:!0,t:ua},orientation:{r:!1,t:ga},margin:{r:!1,t:Gn},limit:{r:!1,t:ma},padding:{r:!1,t:va},behaviour:{r:!0,t:ya},ariaFormat:{r:!1,t:_a},format:{r:!1,t:Sa},tooltips:{r:!1,t:ba},keyboardSupport:{r:!0,t:Ca},documentElement:{r:!1,t:Ea},cssPrefix:{r:!0,t:Ma},cssClasses:{r:!0,t:ka},handleAttributes:{r:!1,t:xa}},n={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:qn,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};r.format&&!r.ariaFormat&&(r.ariaFormat=r.format),Object.keys(t).forEach(function(c){if(!er(r[c])&&n[c]===void 0){if(t[c].r)throw new Error("noUiSlider: '"+c+"' is required.");return}t[c].t(e,er(r[c])?r[c]:n[c])}),e.pips=r.pips;var s=document.createElement("div"),i=s.style.msTransform!==void 0,o=s.style.transform!==void 0;e.transformRule=o?"transform":i?"msTransform":"webkitTransform";var a=[["left","top"],["right","bottom"]];return e.style=a[e.dir][e.ort],e}function Fa(r,e,t){var n=Zo(),s=ea(),i=s&&Ko(),o=r,a,c,d,f,w,m,h=e.spectrum,y=[],x=[],C=[],j=0,P={},T=!1,z=r.ownerDocument,V=e.documentElement||z.documentElement,L=z.body,N=z.dir==="rtl"||e.ort===1?0:100;function G(u,g){var v=z.createElement("div");return g&&se(v,g),u.appendChild(v),v}function ce(u,g){var v=G(u,e.cssClasses.origin),S=G(v,e.cssClasses.handle);if(G(S,e.cssClasses.touchArea),S.setAttribute("data-handle",String(g)),e.keyboardSupport&&(S.setAttribute("tabindex","0"),S.addEventListener("keydown",function(k){return Qe(k,g)})),e.handleAttributes!==void 0){var M=e.handleAttributes[g];Object.keys(M).forEach(function(k){S.setAttribute(k,M[k])})}return S.setAttribute("role","slider"),S.setAttribute("aria-orientation",e.ort?"vertical":"horizontal"),g===0?se(S,e.cssClasses.handleLower):g===e.handles-1&&se(S,e.cssClasses.handleUpper),v.handle=S,v}function we(u,g){return g?G(u,e.cssClasses.connect):!1}function te(u,g){c=G(g,e.cssClasses.connects),d=[],f=[],f.push(we(c,u[0]));for(var v=0;v<e.handles;v++)d.push(ce(g,v)),C[v]=v,f.push(we(c,u[v+1]))}function le(u){se(u,e.cssClasses.target),e.dir===0?se(u,e.cssClasses.ltr):se(u,e.cssClasses.rtl),e.ort===0?se(u,e.cssClasses.horizontal):se(u,e.cssClasses.vertical);var g=getComputedStyle(u).direction;return g==="rtl"?se(u,e.cssClasses.textDirectionRtl):se(u,e.cssClasses.textDirectionLtr),G(u,e.cssClasses.base)}function ue(u,g){return!e.tooltips||!e.tooltips[g]?!1:G(u.firstChild,e.cssClasses.tooltip)}function ge(){return o.hasAttribute("disabled")}function de(u){var g=d[u];return g.hasAttribute("disabled")}function b(u){u!=null?(d[u].setAttribute("disabled",""),d[u].handle.removeAttribute("tabindex")):(o.setAttribute("disabled",""),d.forEach(function(g){g.handle.removeAttribute("tabindex")}))}function l(u){u!=null?(d[u].removeAttribute("disabled"),d[u].handle.setAttribute("tabindex","0")):(o.removeAttribute("disabled"),d.forEach(function(g){g.removeAttribute("disabled"),g.handle.setAttribute("tabindex","0")}))}function p(){m&&(Xe("update"+Oe.tooltips),m.forEach(function(u){u&&hn(u)}),m=null)}function _(){p(),m=d.map(ue),At("update"+Oe.tooltips,function(u,g,v){if(!(!m||!e.tooltips)&&m[g]!==!1){var S=u[g];e.tooltips[g]!==!0&&(S=e.tooltips[g].to(v[g])),m[g].innerHTML=S}})}function E(){Xe("update"+Oe.aria),At("update"+Oe.aria,function(u,g,v,S,M){C.forEach(function(k){var I=d[k],O=at(x,k,0,!0,!0,!0),H=at(x,k,100,!0,!0,!0),q=M[k],Q=String(e.ariaFormat.to(v[k]));O=h.fromStepping(O).toFixed(1),H=h.fromStepping(H).toFixed(1),q=h.fromStepping(q).toFixed(1),I.children[0].setAttribute("aria-valuemin",O),I.children[0].setAttribute("aria-valuemax",H),I.children[0].setAttribute("aria-valuenow",q),I.children[0].setAttribute("aria-valuetext",Q)})})}function F(u){if(u.mode===je.Range||u.mode===je.Steps)return h.xVal;if(u.mode===je.Count){if(u.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var g=u.values-1,v=100/g,S=[];g--;)S[g]=g*v;return S.push(100),A(S,u.stepped)}return u.mode===je.Positions?A(u.values,u.stepped):u.mode===je.Values?u.stepped?u.values.map(function(M){return h.fromStepping(h.getStep(h.toStepping(M)))}):u.values:[]}function A(u,g){return u.map(function(v){return h.fromStepping(g?h.getStep(v):v)})}function $(u){function g(q,Q){return Number((q+Q).toFixed(7))}var v=F(u),S={},M=h.xVal[0],k=h.xVal[h.xVal.length-1],I=!1,O=!1,H=0;return v=Go(v.slice().sort(function(q,Q){return q-Q})),v[0]!==M&&(v.unshift(M),I=!0),v[v.length-1]!==k&&(v.push(k),O=!0),v.forEach(function(q,Q){var X,U,K,ne=q,ee=v[Q+1],re,Lt,It,Nt,br,Pt,xr,_r=u.mode===je.Steps;for(_r&&(X=h.xNumSteps[Q]),X||(X=ee-ne),ee===void 0&&(ee=ne),X=Math.max(X,1e-7),U=ne;U<=ee;U=g(U,X)){for(re=h.toStepping(U),Lt=re-H,br=Lt/(u.density||1),Pt=Math.round(br),xr=Lt/Pt,K=1;K<=Pt;K+=1)It=H+K*xr,S[It.toFixed(5)]=[h.fromStepping(It),0];Nt=v.indexOf(U)>-1?oe.LargeValue:_r?oe.SmallValue:oe.NoValue,!Q&&I&&U!==ee&&(Nt=0),U===ee&&O||(S[re.toFixed(5)]=[U,Nt]),H=re}}),S}function Z(u,g,v){var S,M,k=z.createElement("div"),I=(S={},S[oe.None]="",S[oe.NoValue]=e.cssClasses.valueNormal,S[oe.LargeValue]=e.cssClasses.valueLarge,S[oe.SmallValue]=e.cssClasses.valueSub,S),O=(M={},M[oe.None]="",M[oe.NoValue]=e.cssClasses.markerNormal,M[oe.LargeValue]=e.cssClasses.markerLarge,M[oe.SmallValue]=e.cssClasses.markerSub,M),H=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],q=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];se(k,e.cssClasses.pips),se(k,e.ort===0?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical);function Q(U,K){var ne=K===e.cssClasses.value,ee=ne?H:q,re=ne?I:O;return K+" "+ee[e.ort]+" "+re[U]}function X(U,K,ne){if(ne=g?g(K,ne):ne,ne!==oe.None){var ee=G(k,!1);ee.className=Q(ne,e.cssClasses.marker),ee.style[e.style]=U+"%",ne>oe.NoValue&&(ee=G(k,!1),ee.className=Q(ne,e.cssClasses.value),ee.setAttribute("data-value",String(K)),ee.style[e.style]=U+"%",ee.innerHTML=String(v.to(K)))}}return Object.keys(u).forEach(function(U){X(U,u[U][0],u[U][1])}),k}function D(){w&&(hn(w),w=null)}function ye(u){D();var g=$(u),v=u.filter,S=u.format||{to:function(M){return String(Math.round(M))}};return w=o.appendChild(Z(g,v,S)),w}function Le(){var u=a.getBoundingClientRect(),g="offset"+["Width","Height"][e.ort];return e.ort===0?u.width||a[g]:u.height||a[g]}function he(u,g,v,S){var M=function(I){var O=be(I,S.pageOffset,S.target||g);if(!O||ge()&&!S.doNotReject||Yo(o,e.cssClasses.tap)&&!S.doNotReject||u===n.start&&O.buttons!==void 0&&O.buttons>1||S.hover&&O.buttons)return!1;i||O.preventDefault(),O.calcPoint=O.points[e.ort],v(O,S)},k=[];return u.split(" ").forEach(function(I){g.addEventListener(I,M,i?{passive:!0}:!1),k.push([I,M])}),k}function be(u,g,v){var S=u.type.indexOf("touch")===0,M=u.type.indexOf("mouse")===0,k=u.type.indexOf("pointer")===0,I=0,O=0;if(u.type.indexOf("MSPointer")===0&&(k=!0),u.type==="mousedown"&&!u.buttons&&!u.touches)return!1;if(S){var H=function(X){var U=X.target;return U===v||v.contains(U)||u.composed&&u.composedPath().shift()===v};if(u.type==="touchstart"){var q=Array.prototype.filter.call(u.touches,H);if(q.length>1)return!1;I=q[0].pageX,O=q[0].pageY}else{var Q=Array.prototype.find.call(u.changedTouches,H);if(!Q)return!1;I=Q.pageX,O=Q.pageY}}return g=g||Vn(z),(M||k)&&(I=u.clientX+g.x,O=u.clientY+g.y),u.pageOffset=g,u.points=[I,O],u.cursor=M||k,u}function Se(u){var g=u-Qo(a,e.ort),v=g*100/Le();return v=gn(v),e.dir?100-v:v}function De(u){var g=100,v=!1;return d.forEach(function(S,M){if(!de(M)){var k=x[M],I=Math.abs(k-u),O=I===100&&g===100,H=I<g,q=I<=g&&u>k;(H||q||O)&&(v=M,g=I)}}),v}function ke(u,g){u.type==="mouseout"&&u.target.nodeName==="HTML"&&u.relatedTarget===null&&Ae(u,g)}function Fe(u,g){if(navigator.appVersion.indexOf("MSIE 9")===-1&&u.buttons===0&&g.buttonsProperty!==0)return Ae(u,g);var v=(e.dir?-1:1)*(u.calcPoint-g.startCalcPoint),S=v*100/g.baseSize;pr(v>0,S,g.locations,g.handleNumbers,g.connect)}function Ae(u,g){g.handle&&(wt(g.handle,e.cssClasses.active),j-=1),g.listeners.forEach(function(v){V.removeEventListener(v[0],v[1])}),j===0&&(wt(o,e.cssClasses.drag),jt(),u.cursor&&(L.style.cursor="",L.removeEventListener("selectstart",fn))),e.events.smoothSteps&&(g.handleNumbers.forEach(function(v){Ie(v,x[v],!0,!0,!1,!1)}),g.handleNumbers.forEach(function(v){Y("update",v)})),g.handleNumbers.forEach(function(v){Y("change",v),Y("set",v),Y("end",v)})}function Ue(u,g){if(!g.handleNumbers.some(de)){var v;if(g.handleNumbers.length===1){var S=d[g.handleNumbers[0]];v=S.children[0],j+=1,se(v,e.cssClasses.active)}u.stopPropagation();var M=[],k=he(n.move,V,Fe,{target:u.target,handle:v,connect:g.connect,listeners:M,startCalcPoint:u.calcPoint,baseSize:Le(),pageOffset:u.pageOffset,handleNumbers:g.handleNumbers,buttonsProperty:u.buttons,locations:x.slice()}),I=he(n.end,V,Ae,{target:u.target,handle:v,listeners:M,doNotReject:!0,handleNumbers:g.handleNumbers}),O=he("mouseout",V,ke,{target:u.target,handle:v,listeners:M,doNotReject:!0,handleNumbers:g.handleNumbers});M.push.apply(M,k.concat(I,O)),u.cursor&&(L.style.cursor=getComputedStyle(u.target).cursor,d.length>1&&se(o,e.cssClasses.drag),L.addEventListener("selectstart",fn,!1)),g.handleNumbers.forEach(function(H){Y("start",H)})}}function ot(u){u.stopPropagation();var g=Se(u.calcPoint),v=De(g);v!==!1&&(e.events.snap||pn(o,e.cssClasses.tap,e.animationDuration),Ie(v,g,!0,!0),jt(),Y("slide",v,!0),Y("update",v,!0),e.events.snap?Ue(u,{handleNumbers:[v]}):(Y("change",v,!0),Y("set",v,!0)))}function Ft(u){var g=Se(u.calcPoint),v=h.getStep(g),S=h.fromStepping(v);Object.keys(P).forEach(function(M){M.split(".")[0]==="hover"&&P[M].forEach(function(k){k.call(ct,S)})})}function Qe(u,g){if(ge()||de(g))return!1;var v=["Left","Right"],S=["Down","Up"],M=["PageDown","PageUp"],k=["Home","End"];e.dir&&!e.ort?v.reverse():e.ort&&!e.dir&&(S.reverse(),M.reverse());var I=u.key.replace("Arrow",""),O=I===M[0],H=I===M[1],q=I===S[0]||I===v[0]||O,Q=I===S[1]||I===v[1]||H,X=I===k[0],U=I===k[1];if(!q&&!Q&&!X&&!U)return!0;u.preventDefault();var K;if(Q||q){var ne=q?0:1,ee=wr(g),re=ee[ne];if(re===null)return!1;re===!1&&(re=h.getDefaultStep(x[g],q,e.keyboardDefaultStep)),H||O?re*=e.keyboardPageMultiplier:re*=e.keyboardMultiplier,re=Math.max(re,1e-7),re=(q?-1:1)*re,K=y[g]+re}else U?K=e.spectrum.xVal[e.spectrum.xVal.length-1]:K=e.spectrum.xVal[0];return Ie(g,h.toStepping(K),!0,!0),Y("slide",g),Y("update",g),Y("change",g),Y("set",g),!1}function fr(u){u.fixed||d.forEach(function(g,v){he(n.start,g.children[0],Ue,{handleNumbers:[v]})}),u.tap&&he(n.start,a,ot,{}),u.hover&&he(n.move,a,Ft,{hover:!0}),u.drag&&f.forEach(function(g,v){if(!(g===!1||v===0||v===f.length-1)){var S=d[v-1],M=d[v],k=[g],I=[S,M],O=[v-1,v];se(g,e.cssClasses.draggable),u.fixed&&(k.push(S.children[0]),k.push(M.children[0])),u.dragAll&&(I=d,O=C),k.forEach(function(H){he(n.start,H,Ue,{handles:I,handleNumbers:O,connect:g})})}})}function At(u,g){P[u]=P[u]||[],P[u].push(g),u.split(".")[0]==="update"&&d.forEach(function(v,S){Y("update",S)})}function Xn(u){return u===Oe.aria||u===Oe.tooltips}function Xe(u){var g=u&&u.split(".")[0],v=g?u.substring(g.length):u;Object.keys(P).forEach(function(S){var M=S.split(".")[0],k=S.substring(M.length);(!g||g===M)&&(!v||v===k)&&(!Xn(k)||v===k)&&delete P[S]})}function Y(u,g,v){Object.keys(P).forEach(function(S){var M=S.split(".")[0];u===M&&P[S].forEach(function(k){k.call(ct,y.map(e.format.to),g,y.slice(),v||!1,x.slice(),ct)})})}function at(u,g,v,S,M,k,I){var O;return d.length>1&&!e.events.unconstrained&&(S&&g>0&&(O=h.getAbsoluteDistance(u[g-1],e.margin,!1),v=Math.max(v,O)),M&&g<d.length-1&&(O=h.getAbsoluteDistance(u[g+1],e.margin,!0),v=Math.min(v,O))),d.length>1&&e.limit&&(S&&g>0&&(O=h.getAbsoluteDistance(u[g-1],e.limit,!1),v=Math.min(v,O)),M&&g<d.length-1&&(O=h.getAbsoluteDistance(u[g+1],e.limit,!0),v=Math.max(v,O))),e.padding&&(g===0&&(O=h.getAbsoluteDistance(0,e.padding[0],!1),v=Math.max(v,O)),g===d.length-1&&(O=h.getAbsoluteDistance(100,e.padding[1],!0),v=Math.min(v,O))),I||(v=h.getStep(v)),v=gn(v),v===u[g]&&!k?!1:v}function Ot(u,g){var v=e.ort;return(v?g:u)+", "+(v?u:g)}function pr(u,g,v,S,M){var k=v.slice(),I=S[0],O=e.events.smoothSteps,H=[!u,u],q=[u,!u];S=S.slice(),u&&S.reverse(),S.length>1?S.forEach(function(X,U){var K=at(k,X,k[X]+g,H[U],q[U],!1,O);K===!1?g=0:(g=K-k[X],k[X]=K)}):H=q=[!0];var Q=!1;S.forEach(function(X,U){Q=Ie(X,v[X]+g,H[U],q[U],!1,O)||Q}),Q&&(S.forEach(function(X){Y("update",X),Y("slide",X)}),M!=null&&Y("drag",I))}function gr(u,g){return e.dir?100-u-g:u}function Yn(u,g){x[u]=g,y[u]=h.fromStepping(g);var v=gr(g,0)-N,S="translate("+Ot(v+"%","0")+")";if(d[u].style[e.transformRule]=S,e.events.invertConnects&&x.length>1){var M=x.every(function(k,I,O){return I===0||k>=O[I-1]});if(T!==!M){ns();return}}Ye(u),Ye(u+1),T&&(Ye(u-1),Ye(u+2))}function jt(){C.forEach(function(u){var g=x[u]>50?-1:1,v=3+(d.length+g*u);d[u].style.zIndex=String(v)})}function Ie(u,g,v,S,M,k){return M||(g=at(x,u,g,v,S,!1,k)),g===!1?!1:(Yn(u,g),!0)}function Ye(u){if(f[u]){var g=x.slice();T&&g.sort(function(O,H){return O-H});var v=0,S=100;u!==0&&(v=g[u-1]),u!==f.length-1&&(S=g[u]);var M=S-v,k="translate("+Ot(gr(v,M)+"%","0")+")",I="scale("+Ot(M/100,"1")+")";f[u].style[e.transformRule]=k+" "+I}}function mr(u,g){return u===null||u===!1||u===void 0||(typeof u=="number"&&(u=String(u)),u=e.format.from(u),u!==!1&&(u=h.toStepping(u)),u===!1||isNaN(u))?x[g]:u}function lt(u,g,v){var S=kt(u),M=x[0]===void 0;g=g===void 0?!0:g,e.animate&&!M&&pn(o,e.cssClasses.tap,e.animationDuration),C.forEach(function(O){Ie(O,mr(S[O],O),!0,!1,v)});var k=C.length===1?0:1;if(M&&h.hasNoSize()&&(v=!0,x[0]=0,C.length>1)){var I=100/(C.length-1);C.forEach(function(O){x[O]=O*I})}for(;k<C.length;++k)C.forEach(function(O){Ie(O,x[O],!0,!0,v)});jt(),C.forEach(function(O){Y("update",O),S[O]!==null&&g&&Y("set",O)})}function Zn(u){lt(e.start,u)}function Kn(u,g,v,S){if(u=Number(u),!(u>=0&&u<C.length))throw new Error("noUiSlider: invalid handle number, got: "+u);Ie(u,mr(g,u),!0,!0,S),Y("update",u),v&&Y("set",u)}function vr(u){if(u===void 0&&(u=!1),u)return y.length===1?y[0]:y.slice(0);var g=y.map(e.format.to);return g.length===1?g[0]:g}function es(){for(Xe(Oe.aria),Xe(Oe.tooltips),Object.keys(e.cssClasses).forEach(function(u){wt(o,e.cssClasses[u])});o.firstChild;)o.removeChild(o.firstChild);delete o.noUiSlider}function wr(u){var g=x[u],v=h.getNearbySteps(g),S=y[u],M=v.thisStep.step,k=null;if(e.snap)return[S-v.stepBefore.startValue||null,v.stepAfter.startValue-S||null];M!==!1&&S+M>v.stepAfter.startValue&&(M=v.stepAfter.startValue-S),S>v.thisStep.startValue?k=v.thisStep.step:v.stepBefore.step===!1?k=!1:k=S-v.stepBefore.highestStep,g===100?M=null:g===0&&(k=null);var I=h.countStepDecimals();return M!==null&&M!==!1&&(M=Number(M.toFixed(I))),k!==null&&k!==!1&&(k=Number(k.toFixed(I))),[k,M]}function ts(){return C.map(wr)}function rs(u,g){var v=vr(),S=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips","connect"];S.forEach(function(k){u[k]!==void 0&&(t[k]=u[k])});var M=Jn(t);S.forEach(function(k){u[k]!==void 0&&(e[k]=M[k])}),h=M.spectrum,e.margin=M.margin,e.limit=M.limit,e.padding=M.padding,e.pips?ye(e.pips):D(),e.tooltips?_():p(),x=[],lt(er(u.start)?u.start:v,g),u.connect&&yr()}function yr(){for(;c.firstChild;)c.removeChild(c.firstChild);for(var u=0;u<=e.handles;u++)f[u]=we(c,e.connect[u]),Ye(u);fr({drag:e.events.drag,fixed:!0})}function ns(){T=!T,Wn(e,e.connect.map(function(u){return!u})),yr()}function ss(){a=le(o),te(e.connect,a),fr(e.events),lt(e.start),e.pips&&ye(e.pips),e.tooltips&&_(),E()}ss();var ct={destroy:es,steps:ts,on:At,off:Xe,get:vr,set:lt,setHandle:Kn,reset:Zn,disable:b,enable:l,__moveHandles:function(u,g,v){pr(u,g,x,v)},options:t,updateOptions:rs,target:o,removePips:D,removeTooltips:p,getPositions:function(){return x.slice()},getTooltips:function(){return m},getOrigins:function(){return d},pips:ye};return ct}function Aa(r,e){if(!r||!r.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+r);if(r.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var t=Jn(e),n=Fa(r,t,e);return r.noUiSlider=n,n}const Oa={__spectrum:Hn,cssClasses:qn,create:Aa};class Qn{constructor(){this.playIntervals=new Map,this.playStates=new Map}_processRangeData(e,t,n){const s=e.map(h=>({value:parseInt(h.key,10),count:h.doc_count||0})).filter(h=>!isNaN(h.value)).sort((h,y)=>h.value-y.value),i=t.map(h=>({value:parseInt(h.key,10),count:h.doc_count||0})).filter(h=>!isNaN(h.value)).sort((h,y)=>h.value-y.value);if(s.length===0)throw new Error("No valid numeric values found in range data");const o=s.map(h=>h.value),a=i.map(h=>h.value),c=o[0],d=o[o.length-1],f=[...new Set(a)];let w,m;return n&&n.length===2?(w=Math.max(n[0],c),m=Math.min(n[1],d)):(w=f[0]||c,m=f[f.length-1]||d),{allBuckets:s,availableBuckets:i,sortedAvailableValues:f,minValue:c,maxValue:d,startValue:w,endValue:m}}_createRangeFacetDOM(e,t){const n=document.createElement("div");return n.className="facet-slider my-3",n.innerHTML=this._getRangeFacetHTML(e,t),n}_getRangeFacetHTML(e,{minValue:t,maxValue:n}){return`
      <div class="space-y-3">
        <!-- Play Controls -->
        <div class="play-controls flex items-center justify-center gap-2 pb-3 border-b border-gray-200">
          <button id="${e}-play-btn" class="group relative w-8 h-8 bg-gradient-to-r from-primary-400 to-primary-700 text-white text-xs rounded-full transition-colors duration-200 hover:from-primary-600 hover:to-primary-700 shadow-md hover:shadow-lg flex items-center justify-center" type="button">
            <div class="w-0 h-0 border-l-[5px] border-l-white border-y-[3px] border-y-transparent ml-0.5"></div>
            <span class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap">Play</span>
          </button>
          <button id="${e}-pause-btn" class="group relative w-8 h-8 bg-gradient-to-r from-secondary-400 to-secondary-700 text-white text-xs rounded-full transition-colors duration-200 hover:from-secondary-600 hover:to-secondary-700 shadow-md hover:shadow-lg flex items-center justify-center" type="button">
            <div class="flex gap-0.5">
              <div class="w-0.5 h-3 bg-white rounded-sm"></div>
              <div class="w-0.5 h-3 bg-white rounded-sm"></div>
            </div>
            <span class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap">Pause</span>
          </button>
        </div>

        <!-- Chart Container -->
        <div class="relative">
          <div id="${e}-chart" class="w-full h-16 mb-3 bg-gray-50 rounded-md p-2"></div>
        </div>
        
        <!-- Slider Container -->
        <div class="px-1">
          <div id="${e}-slider" class="slider-container"></div>
        </div>
        
        <!-- Value Display -->
        <div class="flex items-center justify-between text-xs text-gray-600 px-1">
          <span id="${e}-min-display" class="font-medium">${t}</span>
          <span id="${e}-max-display" class="font-medium">${n}</span>
        </div>
        
        <!-- Custom Range Inputs -->
        <div class="mt-4 pt-3 border-t border-gray-100">
          <div class="text-xs font-medium text-gray-700 mb-2">Custom range:</div>
          <div class="grid grid-cols-2 gap-2">
            <div class="min-w-0">
              <input id="${e}-min-input" type="number"
                    class="w-full px-2 py-1 text-xs border border-gray-200 rounded focus:ring-1 focus:ring-primary-400 focus:border-primary-400 focus:outline-none"
                    value="${t}"
                    placeholder="Min">
            </div>
            <div class="min-w-0">
              <input id="${e}-max-input" type="number"
                    class="w-full px-2 py-1 text-xs border border-gray-200 rounded focus:ring-1 focus:ring-primary-400 focus:border-primary-400 focus:outline-none"
                    value="${n}"
                    placeholder="Max">
            </div>
          </div>
        </div>
      </div>
    `}_getSliderElements(e,t){return{chartElement:e.querySelector(`#${t}-chart`),slider:e.querySelector(`#${t}-slider`),minInput:e.querySelector(`#${t}-min-input`),maxInput:e.querySelector(`#${t}-max-input`),minDisplay:e.querySelector(`#${t}-min-display`),maxDisplay:e.querySelector(`#${t}-max-display`),playBtn:e.querySelector(`#${t}-play-btn`),pauseBtn:e.querySelector(`#${t}-pause-btn`)}}_initializeSlider(e,t){Oa.create(e,{start:[t.startValue,t.endValue],connect:!0,step:1,range:{min:t.minValue,max:t.maxValue},format:{to:n=>Math.round(n),from:n=>parseInt(n,10)}}),e.classList.add("custom-slider")}_setupEventHandlers(e,t,n,s){t.slider.noUiSlider.on("update",i=>{const[o,a]=i.map(c=>Math.round(Number(c)));t.minDisplay.textContent=o.toString(),t.maxDisplay.textContent=a.toString(),document.activeElement!==t.minInput&&(t.minInput.value=o),document.activeElement!==t.maxInput&&(t.maxInput.value=a)}),t.slider.noUiSlider.on("change",i=>{const[o,a]=i.map(c=>Math.round(Number(c)));!isNaN(o)&&!isNaN(a)&&o>=n.minValue&&a<=n.maxValue&&this._updateRange(e,[o,a],s,t.chartElement,n.allBuckets,n)}),t.minInput.addEventListener("change",i=>{this._handleInputChange(i.target,!0,e,t,n,s)}),t.maxInput.addEventListener("change",i=>{this._handleInputChange(i.target,!1,e,t,n,s)}),[t.minInput,t.maxInput].forEach(i=>{i.addEventListener("keypress",o=>{o.key==="Enter"&&o.target.blur()})}),this.setupPlayControls(e,t.playBtn,t.pauseBtn,t.slider,n.sortedAvailableValues,s,t.chartElement,n.allBuckets)}_validateAndClampInput(e,t,n){const s=parseInt(e,10);return isNaN(s)?null:Math.max(t,Math.min(n,s))}_storeSliderReferences(e,t,n){e.slider=t.slider,e.sortedValues=n.sortedAvailableValues,Object.assign(e,t),e.cleanup=()=>{t.slider.noUiSlider&&t.slider.noUiSlider.destroy(),this.playStates.delete(e.facetKey)}}setupPlayControls(e,t,n,s,i,o,a,c){t.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.startPlay(e,t,n,s,i,o,a,c)}),n.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.pausePlay(e,t,n)})}startPlay(e,t,n,s,i,o,a,c){if(this.playIntervals.has(e))return;const[d,f]=s.noUiSlider.get().map(Number),w=this._findClosestDatasetValue(i,d),m=this._findClosestDatasetValue(i,f);let h=this.playStates.get(e);if(h)h.currentMaxIndex>=h.maxLimitIndex&&(h.currentMaxIndex=h.startMinIndex,this.playStates.set(e,h));else{const x=i.indexOf(w),C=i.indexOf(m);h={startMinIndex:x,currentMaxIndex:x,maxLimitIndex:C,originalMin:w,originalMax:m},this.playStates.set(e,h)}const y=setInterval(()=>{const x=this.playStates.get(e);if(!x){clearInterval(y),this.playIntervals.delete(e);return}let{startMinIndex:C,currentMaxIndex:j,maxLimitIndex:P}=x;if(j=Math.min(j+1,P),j>=P){const V=i[C],L=i[P];s.noUiSlider.set([V,L]);const N=s.closest(".facet-slider");N.minValue,N.maxValue,o({type:"RANGE_CHANGE",facetKey:e,value:[V,L]}),this.updateChartHighlight(a,c,V,L),this.playStates.delete(e),this.pausePlay(e,t,n);return}this.playStates.set(e,{...x,currentMaxIndex:j});const T=i[C],z=i[j];s.noUiSlider.set([T,z]),o({type:"RANGE_CHANGE",facetKey:e,value:[T,z]}),this.updateChartHighlight(a,c,T,z)},500);this.playIntervals.set(e,y)}pausePlay(e,t,n){const s=this.playIntervals.get(e);s&&(clearInterval(s),this.playIntervals.delete(e))}_updateRange(e,[t,n],s,i,o,a){this.playStates.delete(e);let c;t===a.minValue&&n===a.maxValue?c=null:c=[t,n],s({type:"RANGE_CHANGE",facetKey:e,value:c}),this.updateChartHighlight(i,o,t,n)}_handleInputChange(e,t,n,s,i,o){const a=this._validateAndClampInput(e.value,i.minValue,i.maxValue);if(a===null)return;const[c,d]=s.slider.noUiSlider.get().map(Number),f=t?[Math.max(i.minValue,Math.min(a,d)),d]:[c,Math.min(i.maxValue,Math.max(a,c))];this._updateRange(n,f,o,s.chartElement,i.allBuckets,i),s.slider.noUiSlider.set(f)}_findClosestDatasetValue(e,t){if(e.length===0)return t;if(t<=e[0])return e[0];if(t>=e[e.length-1])return e[e.length-1];let n=0,s=e.length-1;for(;n<=s;){const a=Math.floor((n+s)/2),c=e[a];if(c===t)return c;c<t?n=a+1:s=a-1}if(s<0)return e[0];if(n>=e.length)return e[e.length-1];const i=Math.abs(e[n]-t),o=Math.abs(e[s]-t);return i<=o?e[n]:e[s]}updateChartHighlight(e,t,n,s){const i=e.querySelector(".flex.items-end");if(!i){console.warn("Bars container not found");return}i.querySelectorAll("[data-value]").forEach(a=>{const c=parseInt(a.dataset.value),d=parseInt(a.dataset.count);c>=n&&c<=s?d>0?a.style.backgroundColor="#d1d5db":a.style.backgroundColor="#bfdbfe":a.style.backgroundColor="#d1d5db"})}renderBarChart(e,t,n,s,i,o=null){e.innerHTML="";const a=Math.max(...n.map(w=>w.count),1);this.sortedAllBuckets=[...t].sort((w,m)=>w.value-m.value);const c=document.createElement("div");c.className="w-full h-full flex flex-col",e.appendChild(c);const d=document.createElement("div");d.className="w-full flex-1 rounded px-1 overflow-hidden",d.style.height="150px",c.appendChild(d);const f=document.createElement("div");f.className="flex items-end w-full h-full",d.appendChild(f),this.sortedAllBuckets.forEach(w=>{const m=w.count>0?w.count/a*90:2,h=document.createElement("div");h.className="flex-1 mx-px transition-colors duration-200",h.style.height=`${Math.max(m,1)}%`,h.dataset.value=w.value,h.dataset.count=w.count,w.count>0?(h.title=`Value: ${w.value}, Count: ${w.count}`,h.style.backgroundColor="#3b82f6"):(h.title=`Value: ${w.value}, No data available`,h.style.backgroundColor="#d1d5db"),f.appendChild(h)})}_renderEmptyRangeFacet(e,t){const n=document.createElement("div");return n.className="facet-slider my-3 text-center text-gray-500 py-4",n.innerHTML='<p class="text-sm">No data available for this range</p>',e.appendChild(n),n}_renderRangeFacet(e,t,n,s,i,o,a){var x;const c=s[t]||[];console.log(`=== RangeRenderer for ${t} ===`),console.log("Received state:",o),console.log("state.filters:",o==null?void 0:o.filters),console.log("state.filters[facetKey]:",(x=o==null?void 0:o.filters)==null?void 0:x[t]),console.log("=====================================");const d=c.filter(C=>C.doc_count>0);if(!c||c.length===0)return this._renderEmptyRangeFacet(e,t);const f=this._processRangeData(c,d,o.filters[t]);if(f.sortedAvailableValues.length===0){const C=document.createElement("div");return C.className="facet-slider my-3 text-center text-gray-500 py-4",C.innerHTML=`
        <p class="text-sm">No values available with current filters</p>
        <p class="text-xs text-gray-400">Range: ${f.minValue} - ${f.maxValue}</p>
      `,e.appendChild(C),C}const w=f.sortedAvailableValues[0],m=f.sortedAvailableValues[f.sortedAvailableValues.length-1];if(w===m){const C=w+1;f.sliderMax=C,f.endValue=w}const h=this._createRangeFacetDOM(t,{minValue:f.minValue,maxValue:f.maxValue});e.appendChild(h);const y=this._getSliderElements(h,t);return this.renderBarChart(y.chartElement,f.allBuckets,f.availableBuckets,f.minValue,f.maxValue),this._initializeSlider(y.slider,f),this._setupEventHandlers(t,y,f,a),this.updateChartHighlight(y.chartElement,f.allBuckets,f.startValue,f.endValue),this._storeSliderReferences(h,y,f),h}}class ja{constructor(e){this.config=e,this.taxonomyRenderer=new Un,this.rangeRenderer=new Qn,this.searchTerms={}}renderFacets(e,t,n){if(!e||!this.config.aggregations){console.error("No aggregations data or configuration available.");return}const s=document.getElementById("facets-container"),i=this._getCheckedState();s.innerHTML="";const o={};Object.entries(this.config.aggregations).forEach(([a,c])=>{const d=c.category||"Other";o[d]||(o[d]=[]),o[d].push({facetKey:a,facetConfig:c})}),Object.entries(o).forEach(([a,c])=>{const d=document.createElement("div");d.className="facet-category",d.setAttribute("data-category",a);const f=document.createElement("h3");f.className="facet-category-title",f.textContent=a,d.appendChild(f);const w=document.createElement("div");w.className="facet-category-content",c.forEach(({facetKey:m,facetConfig:h})=>{const y=this._createFacetGroup(m,h);h.type==="range"?this.rangeRenderer._renderRangeFacet(y,m,h,e,i,t,n):h.type==="taxonomy"?this.taxonomyRenderer._renderTaxonomyFacet(y,m,h,e,i,t,n):h.type==="simple"&&this._renderStandardFacet(y,m,h,e,i,t,n),w.appendChild(y)}),d.appendChild(w),s.appendChild(d)}),this._addFacetEventListeners(n)}_filterFacetOptions(e,t){const n=e.querySelectorAll("label");let s=0;n.forEach(i=>{const o=i.textContent.toLowerCase(),a=t===""||o.includes(t);i.classList.toggle("facet-hidden",!a),a&&s++}),this._showNoResultsMessage(e,s===0&&t!=="")}_showNoResultsMessage(e,t){let n=e.querySelector(".no-results-disclaimer");t?(n||(n=document.createElement("div"),n.className="no-results-disclaimer",n.textContent="Nessun risultato per questa ricerca",n.style.cssText="padding: 10px; color: #666; font-style: italic;",e.appendChild(n)),n.style.display="block"):n&&(n.style.display="none"),e.style.display="block"}_updateCategoryVisibility(){document.querySelectorAll(".facet-category").forEach(t=>{const n=t.querySelectorAll('.facet-group[style*="display: block"], .facet-group:not([style*="display: none"])'),s=Array.from(n).some(i=>i.style.display!=="none");t.style.display=s?"block":"none"})}_getCheckedState(){const e={};return Object.keys(this.config.aggregations).forEach(t=>{const n=document.getElementById(`${t}-facet`);n&&(e[t]=Array.from(n.querySelectorAll("input:checked")).map(s=>s.value))}),e}_createFacetGroup(e,t){const n=document.createElement("div");n.className="facet-group mb-4 p-4 bg-white rounded-lg shadow",n.id=`${e}-facet`;const s=document.createElement("div");s.className="facet-header mb-3";const i=document.createElement("h3");if(i.className="text-lg font-semibold mb-2",i.textContent=t.title||e,s.appendChild(i),t.type=="simple"){const o=document.createElement("div");o.className="facet-search mb-2";const a=document.createElement("input");a.type="text",a.className="facet-search-input w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-primary-500",a.placeholder="Cerca...",a.id=`search-${e}`;const c=this._debounce(d=>{this._searchWithinFacet(e,d)},300);a.addEventListener("input",d=>{c(d.target.value)}),o.appendChild(a),s.appendChild(o)}return n.appendChild(s),n}_searchWithinFacet(e,t){const n=document.getElementById(`${e}-facet`);n&&(this.searchTerms[e]=t.toLowerCase().trim(),this._filterFacetOptions(n,this.searchTerms[e]))}_renderStandardFacet(e,t,n,s,i,o,a){const c=document.createElement("div");c.className="facet-options space-y-2";const d=s[t]||[],f=o.filters||{};d.forEach(w=>{var T;const m=(T=f[t])==null?void 0:T.includes(w.key),h=w.doc_count===0,y=document.createElement("label");y.className="block facet-option flex items-center justify-between",y.style.display="flex",y.setAttribute("data-search-text",w.key.toLowerCase()),h?y.classList.add("text-gray-400","cursor-not-allowed","opacity-50"):y.classList.add("cursor-pointer");const x=document.createElement("div");x.className="flex items-center";const C=document.createElement("input");C.type="checkbox",C.value=w.key,C.dataset.facetType=t,C.checked=m,C.disabled=h,C.className="form-checkbox mr-2",x.appendChild(C);const j=document.createElement("span");j.textContent=w.key,j.className="text-sm";const P=document.createElement("span");P.textContent=w.doc_count,P.className=`text-xs px-2 py-0.5 rounded-full flex-shrink-0 ml-auto ${h?"text-gray-400 bg-gray-100":"text-secondary-500 bg-secondary-100"}`,x.appendChild(j),y.appendChild(x),y.appendChild(P),c.appendChild(y)}),e.appendChild(c)}_addFacetEventListeners(e){if(!this.config.aggregations){console.error("Aggregations configuration not found");return}Object.keys(this.config.aggregations).forEach(t=>{const n=document.getElementById(`${t}-facet`);n&&n.querySelectorAll('input[type="checkbox"]').forEach(s=>{s.addEventListener("change",i=>{this._onFacetChange(i,e)})})})}_onFacetChange(e,t){const{value:n,checked:s}=e.target,i=e.target.dataset.facetType;t({type:"FACET_CHANGE",facetType:i,value:n,checked:s})}clearAllSearches(){this.searchTerms={},Object.keys(this.config.aggregations).forEach(s=>{const i=document.getElementById(`search-${s}`);i&&(i.value="")}),document.querySelectorAll(".facet-option, label").forEach(s=>{s.style.display="block"}),document.querySelectorAll(".facet-group").forEach(s=>{s.style.display="block"}),document.querySelectorAll(".facet-category").forEach(s=>{s.style.display="block"})}_debounce(e,t){let n;return function(){clearTimeout(n),n=setTimeout(()=>e.apply(this,arguments),t)}}}class La{constructor(e,t){this.searchEngine=e,this.config=t}performSearch(e,t={}){if(!this.searchEngine){console.error("Search engine not initialized");return}const{filters:n}=e,{regularFilters:s,dateFilters:i,taxonomyFilters:o}=this._separateFilters(n),a=this.searchEngine.search({query:e.query||"",filters:s,sort:e.sort||"title_asc",per_page:1e3,filter:d=>this._customFilter(d,i,o)}),c=this._extractCoordinates(a.data.items);if(t.onMarkersUpdate&&t.onMarkersUpdate(a.data.items),t.onResultsUpdate&&t.onResultsUpdate(a.data.items),t.onAggregationsUpdate){const d=this._formatAggregations(a.data.aggregations);t.onAggregationsUpdate(d)}return{items:a.data.items,coordinates:c,aggregations:this._formatAggregations(a.data.aggregations)}}_separateFilters(e){const t={},n={},s={};return Object.entries(e).forEach(([i,o])=>{if(!o||o.length===0)return;const a=this.config.aggregations[i];if(a)switch(a.type){case"range":n[i]=o;break;case"taxonomy":s[i]=o;break;default:t[i]=o}}),{regularFilters:t,dateFilters:n,taxonomyFilters:s}}_customFilter(e,t,n){for(const[s,i]of Object.entries(t))if(i.length===2){const[o,a]=i,c=new Date(e[s]).getTime();if(!(c>=o&&c<=a))return!1}for(const[s,i]of Object.entries(n)){if(!e[s])return!1;const o=e[s];let a;if(Array.isArray(o)?a=o.length>0?String(o[0]):"":typeof o=="string"?a=o:a=String(o||""),!i.some(d=>a===d||a.startsWith(d+" > ")))return!1}return!0}_extractCoordinates(e){return e.filter(t=>t.lat_long&&t.lat_long.length>0).map(t=>{const n=t.lat_long[0],[s,i]=n.split(",");return[parseFloat(s),parseFloat(i)]})}_formatAggregations(e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=e[n].buckets);return t}}class Ia{constructor(e){this.mapFocusCallback=e,this.allWorks=[],this.modalRenderer=new gs(e)}updateResultsList(e,t,n={}){const s=document.getElementById("results");if(!s){console.error("Results container not found");return}this.items=e,this.searchState=n;const i=this._groupByIdOpera(e);this.allWorks=Object.values(i);const o=e.map(a=>a.pivot_ID);this.allWorks.sort((a,c)=>o.indexOf(a.pivot_ID)-o.indexOf(c.pivot_ID)),this.modalRenderer.setData(this.allWorks,this.items),this.modalRenderer.setConfig(t),this.modalRenderer.setSearchState(n),s.innerHTML=this.allWorks.map((a,c)=>this._renderResultItem(a,c)).join(""),this._addMapFocusListeners(),this._addModalListeners()}focusOnResult(e){const t=document.querySelector(`[data-result-id="${e}"]`);return t?(this._openFiltersPanel(),t.scrollIntoView({behavior:"smooth",block:"center"}),this._highlightResult(t),console.log(`Focused on result with pivot_ID: ${e}`),!0):(console.warn(`Result with pivot_ID ${e} not found in current results`),!1)}_openFiltersPanel(){const e=document.getElementById("results-panel");e?(e.classList.remove("panel-closed-right"),console.log("Filters panel opened")):console.warn('Filters panel with ID "results-panel" not found')}_highlightResult(e){const t=document.querySelector(".result-highlighted");t&&t.classList.remove("result-highlighted"),e.classList.add("result-highlighted"),e.style.transition="all 0.3s ease",e.style.transform="scale(1.02)",setTimeout(()=>{e.style.transform=""},1e3),setTimeout(()=>{e.classList.remove("result-highlighted")},3e3)}_groupByIdOpera(e){const t={};return e.forEach(n=>{const s=n.pivot_ID;t[s]||(t[s]={pivot_ID:s,Title:n[window.ledaSearch.config.result_cards.card_title],Subtitle:n[window.ledaSearch.config.result_cards.card_subtitle]||"",Subtitle2:n[window.ledaSearch.config.result_cards.card_subtitle_2]||"",Description:n[window.ledaSearch.config.result_cards.card_description]||"",Location:[],coordinates:[]}),n.Location&&(Array.isArray(n.Location)?n.Location:[n.Location]).forEach((o,a)=>{if(!t[s].Location.includes(o)){t[s].Location.push(o);const c=this._extractCoordinatesFromItem(n,a);t[s].coordinates.push(c)}})}),t}_renderResultItem(e,t){const n=e.Location.map((s,i)=>{const o=e.coordinates[i],a=o&&o.lat&&o.lng;return`
        <button class="focus-map-btn inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-200 hover:shadow-sm hover:scale-105 active:scale-95 cursor-pointer transform 
                       ${a?"bg-secondary-100 hover:bg-secondary-200 text-secondary-700 border border-secondary-200":"bg-gray-100 text-gray-500 border border-gray-200"}" 
                data-space="${encodeURIComponent(s)}" 
                ${a?`data-lat="${o.lat}" data-lng="${o.lng}"`:""}
                title="${a?"Clicca per visualizzare sulla mappa":"Coordinate non disponibili"}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4 mr-1 ${a?"":"opacity-50"}">
            <path fill-rule="evenodd" d="m7.539 14.841.003.003.002.002a.755.755 0 0 0 .912 0l.002-.002.003-.003.012-.009a5.57 5.57 0 0 0 .19-.153 15.588 15.588 0 0 0 2.046-2.082c1.101-1.362 2.291-3.342 2.291-5.597A5 5 0 0 0 3 7c0 2.255 1.19 4.235 2.292 5.597a15.591 15.591 0 0 0 2.046 2.082 8.916 8.916 0 0 0 .189.153l.012.01ZM8 8.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z" clip-rule="evenodd" />
          </svg>
          ${s}
        </button>
      `}).join("");return`
  <div class="result-card bg-white rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition-all duration-300 p-6" 
       data-result-id="${e.pivot_ID}">
    <!-- Header with Title, Subtitles and Button -->
    <div class="flex items-start justify-between gap-4 mb-4">
      <div class="min-w-0 flex-1">
        <h1 class="text-xl font-bold text-gray-900 leading-tight">${e.Title}</h1>
        <div class="flex items-center gap-4 mt-2">
          ${e.Subtitle?`<p class="text-lg text-gray-700 font-medium truncate">${e.Subtitle}</p>`:""}
          ${e.Subtitle&&e.Subtitle2?'<span class="w-1.5 h-1.5 bg-gray-400 rounded-full flex-shrink-0"></span>':""}
          ${e.Subtitle2?`<p class="text-lg text-gray-600 font-mono flex-shrink-0">${e.Subtitle2}</p>`:""}
        </div>
      </div>
      
      <!-- More button -->
      <button class="modal-toggle-btn inline-flex items-center px-4 py-2 rounded-full shadow-md hover:shadow-lg transition-all duration-200 flex-shrink-0 bg-primary-500 hover:bg-primary-600 text-white"
              data-work-index="${t}"
              title="Visualizza tutte le opere">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
        </svg>
      </button>
    </div>
    
    <!-- Description with vertical bar -->
    ${e.Description?`
      <div class="flex items-stretch gap-2">
        <div class="w-1 bg-gradient-to-b from-primary-500 to-primary-600 rounded-full shadow-sm flex-shrink-0"></div>
        <p class="text-xxs text-gray-600 flex-1 leading-tight">${e.Description}</p>
      </div>
    `:""}
    
    <!-- Locations -->
    ${n?`
      <div class="pt-4 border-t border-gray-200 mt-4">
        <div class="flex flex-wrap gap-2">
          ${n}
        </div>
      </div>
    `:""}
  </div>
`}_addModalListeners(){document.querySelectorAll(".modal-toggle-btn").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=parseInt(e.getAttribute("data-work-index"));this.modalRenderer.toggleModal(n)})})}_extractCoordinatesFromItem(e,t){let n={lat:null,lng:null};if(Array.isArray(e.lat_long)&&e.lat_long.length>t){const s=e.lat_long[t];if(s&&typeof s=="string"){const i=s.split(",");if(i.length===2){const o=parseFloat(i[0].trim()),a=parseFloat(i[1].trim());!isNaN(o)&&!isNaN(a)&&(n.lat=o,n.lng=a)}}}else if(e.lat_long&&typeof e.lat_long=="string"){const s=e.lat_long.split(",");if(s.length===2){const i=parseFloat(s[0].trim()),o=parseFloat(s[1].trim());!isNaN(i)&&!isNaN(o)&&(n.lat=i,n.lng=o)}}return n}_addMapFocusListeners(){document.querySelectorAll(".focus-map-btn").forEach(e=>{e.addEventListener("click",t=>{const n=e.getAttribute("data-lat"),s=e.getAttribute("data-lng"),i=decodeURIComponent(e.getAttribute("data-space"));n&&s&&this.mapFocusCallback?this.mapFocusCallback(parseFloat(n),parseFloat(s),i):console.warn("Coordinate non disponibili per questo luogo:",i)})})}}class Na{constructor(e,t){this.config=e,this.searchEngine=t,this.components={}}async initializeComponents(e){const t=us(this.config);return this.components.map=t.map,this.components.markers=t.markers,this.components.renderMarkers=t.renderMarkers,this.components.setFocusResultCallback=t.setFocusResultCallback,this.components.mapInstance=t,window.ledaSearch||(window.ledaSearch={}),window.ledaSearch.config=this.config,window.ledaSearch.mapInstance=this.components.mapInstance,window.switchMarkerType=n=>{this.components.mapInstance&&this.components.mapInstance.switchMarkerType&&this.components.mapInstance.switchMarkerType(n)},this.components.facetRenderer=new ja(this.config),this.components.rangeRenderer=new Qn,this.components.taxonomyRenderer=new Un,this.components.searchHandler=new La(this.searchEngine,this.config),this.components.resultsRenderer=new Ia((n,s,i)=>{this.components.mapInstance&&this.components.mapInstance.focusOnLocation&&this.components.mapInstance.focusOnLocation(n,s,i)}),this.components.navBar=qo,this.components}connectMapToResults(e,t,n){t&&t(s=>{const i=e.focusOnResult(s);return!i&&n&&n("Item not found in current results","warning"),i})}getComponents(){return this.components}}class Pa{constructor(){this.config=null,this.searchEngine=null,this.universalNav=null,this.universalFooter=null,this.stateManager=null,this.searchCoordinator=null,this.uiManager=null,this.filterManager=null,this.eventCoordinator=null,this.componentsInitializer=null,this.components={},this.isInitialLoad=!0,this.isFullyLoaded=!1,this.shouldFocusOnFilter=!1,this.initialize()}async initialize(){try{this.uiManager=new Io,this.uiManager.showFullScreenLoader(),this.config=await os();const e=await cs();this.config.searchConfig.per_page=e.length,new as(this.config).render(),new ls(this.config).render(),this.searchEngine=Ao(e,this.config),this.initializeManagers(),await this.initializeComponents(),this.setupEvents(),await this.performSearch(),await this.applyUrlFilters(),this.isInitialLoad=!1,this.isFullyLoaded=!0}catch(e){console.error("Initialization error:",e),this.uiManager.showNotification("Error loading application","error"),this.uiManager.hideFullScreenLoader()}this.uiManager.hideFullScreenLoader()}initializeManagers(){this.stateManager=new Oo(this.config),this.searchCoordinator=new Lo(null,this.config),this.filterManager=new No(this.stateManager,this.config),this.eventCoordinator=new Po(this.stateManager,this.config,{onSearch:()=>this.searchCoordinator.debouncedSearch(this.stateManager.getState(),this.getSearchCallbacks()),onSortChange:()=>this.performSearch(),onClearAllFilters:()=>this.clearAllFilters(),onRemoveFilter:(e,t)=>this.removeFilter(e,t),onClearSearchQuery:()=>this.clearSearchQuery()})}async initializeComponents(){this.componentsInitializer=new Na(this.config,this.searchEngine),this.components=await this.componentsInitializer.initializeComponents((e,t,n)=>this.focusOnMap(e,t,n)),this.searchCoordinator.searchHandler=this.components.searchHandler,this.componentsInitializer.connectMapToResults(this.components.resultsRenderer,this.components.setFocusResultCallback,(e,t)=>this.uiManager.showNotification(e,t))}setupEvents(){this.eventCoordinator.bindEvents(),this.eventCoordinator.bindNavBarEvents(this.components.navBar)}getSearchCallbacks(){return{onMarkersUpdate:e=>this.components.renderMarkers(e),onResultsUpdate:e=>{this.components.resultsRenderer.updateResultsList(e,this.config,{filters:this.stateManager.getState().filters,query:this.stateManager.getState().query,sort:this.stateManager.getState().sort})},onAggregationsUpdate:e=>this.renderFacets(e),onNavBarUpdate:e=>this.updateNavBar(e),onBoundsCalculated:e=>this.handleMapBounds(e),onError:(e,t)=>this.uiManager.showNotification(e,t)}}handleMapBounds(e){if(console.log(" handleMapBounds called"),console.log("  - isInitialLoad:",this.isInitialLoad),console.log("  - shouldFocusOnFilter:",this.shouldFocusOnFilter),console.log("  - has bounds:",!!e),console.log("  - has map:",!!this.components.map),!this.isInitialLoad&&this.shouldFocusOnFilter&&e&&this.components.map){console.log(" Applying map focus to bounds:",e);try{this.components.map.fitBounds([e.southwest,e.northeast],{padding:[50,50],maxZoom:15,animate:!0,duration:1}),console.log(" Map focus applied successfully")}catch(t){console.error(" Error focusing map:",t)}this.shouldFocusOnFilter=!1}else console.log(" Skipping map focus")}async performSearch(){const e=this.stateManager.getState();return await this.searchCoordinator.performSearch(e,this.getSearchCallbacks())}async handleStateChange(e){console.log(" handleStateChange called with action:",e),(e.type==="FACET_CHANGE"||e.type==="RANGE_CHANGE")&&(this.shouldFocusOnFilter=!0,console.log(" Filter change detected - shouldFocusOnFilter = TRUE")),await this.stateManager.handleStateChange(e,{onStateChange:async t=>{var s;window.ledaSearch.state=t;const n=await this.searchCoordinator.performSearch(t,this.getSearchCallbacks());console.log(" Filter search completed:",((s=n==null?void 0:n.items)==null?void 0:s.length)||0,"items")}})}renderFacets(e){this.components.facetRenderer.renderFacets(e,this.stateManager.getState(),t=>{console.log(" Facet action intercepted:",t.type),this.handleStateChange(t)})}updateNavBar(e=[]){this.components.navBar.updateFromSearchState(this.stateManager.getState(),e)}focusOnMap(e,t,n){this.components.mapInstance&&this.components.mapInstance.focusOnLocation&&this.components.mapInstance.focusOnLocation(e,t,n)}async applyUrlFilters(){this.shouldFocusOnFilter=!0,console.log(" Applying URL filters - shouldFocusOnFilter = TRUE"),await this.filterManager.applyUrlFilters({onApplyFilters:async()=>await this.performSearch(),onShowNotification:(e,t)=>this.uiManager.showFilterNotification(e,t),onError:(e,t)=>this.uiManager.showNotification(e,t)})}clearAllFilters(){this.shouldFocusOnFilter=!1,console.log(" Clearing all filters - shouldFocusOnFilter = FALSE"),this.filterManager.clearAllFilters(),this.performSearch()}removeFilter(e,t){this.shouldFocusOnFilter=!0,console.log(" Removing filter - shouldFocusOnFilter = TRUE"),this.filterManager.removeFilter(e,t),this.performSearch()}clearSearchQuery(){this.shouldFocusOnFilter=!1,this.filterManager.clearSearchQuery(),this.performSearch()}getLoadingStatus(){return{isLoading:this.searchCoordinator.getLoadingStatus().isLoading,isFullyLoaded:this.isFullyLoaded,searchEngineReady:!!this.searchEngine,mapReady:!!this.components.map,configLoaded:!!this.config}}}document.addEventListener("DOMContentLoaded",()=>{window.ledaSearch=new Pa})});export default Ra();
